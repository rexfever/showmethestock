# ìŠ¤ìºë„ˆ í™”ë©´ ë°ì´í„° í‘œì‹œ ë¬¸ì œ ê°œì„  ê³„íš

## ğŸ“‹ ë¬¸ì œ í˜„í™©

**ì¦ìƒ:**
- ìŠ¤ìºë„ˆ í™”ë©´ì— ë‚ ì§œê°€ ì´ìƒí•˜ê²Œ í‘œì‹œë¨
- ì¢…ê°€ê°€ ì „ë‚  ë˜ëŠ” ì˜ëª»ëœ ë°ì´í„°ë¡œ í‘œì‹œë¨
- í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ìŠ¤ìº” ê²°ê³¼ë¥¼ ì¡°íšŒí•˜ì§€ ëª»í•¨

## ğŸ” ì›ì¸ ë¶„ì„

### 1. API íë¦„ ë¶„ì„

#### í˜„ì¬ ìŠ¤ìº” â†’ ì €ì¥ â†’ ì¡°íšŒ í”Œë¡œìš°

```
[ìŠ¤ì¼€ì¤„ëŸ¬]
  â†“ GET /scan?save_snapshot=true

[ìŠ¤ìº” ì‹¤í–‰]
  â†“ api.get_ohlcv(code, 220) Ã— 50ë²ˆ (KOSPI 25 + KOSDAQ 25)
  â”œâ”€ 220ì¼ì¹˜ OHLCV ë°ì´í„° ì¡°íšŒ
  â”œâ”€ ì§€í‘œ ê³„ì‚° (RSI, MACD, TEMA ë“±)
  â””â”€ 5ê°œ ì¢…ëª© ë§¤ì¹­

[DB ì €ì¥] _save_snapshot_db()
  â”œâ”€ create_scan_rank_table(cur)  âœ… í…Œì´ë¸” ìƒì„±
  â”œâ”€ for it in items (5ê°œ):
  â”‚   â”œâ”€ volume = 0  âŒ it.indicators.VOL ìˆëŠ”ë° ëª» ì°¾ìŒ
  â”‚   â”œâ”€ change_rate = 0.0  âŒ indicatorsì— ì—†ìŒ
  â”‚   â””â”€ api.get_stock_quote(it.ticker)  âŒ ë˜ API í˜¸ì¶œ Ã— 5ë²ˆ
  â”‚       â””â”€ api.get_ohlcv(code, 2)  â† 2ì¼ì¹˜ ë˜ ì¡°íšŒ (ì¤‘ë³µ!)
  â””â”€ INSERT INTO scan_rank
      â”œâ”€ close_price: âœ… ì •ìƒ ì €ì¥
      â”œâ”€ volume: âŒ 0ìœ¼ë¡œ ì €ì¥ë¨ (ë°ì´í„° ì†ì‹¤)
      â”œâ”€ change_rate: âŒ 0.0ìœ¼ë¡œ ì €ì¥ë¨ (ë°ì´í„° ì†ì‹¤)
      â””â”€ indicators JSON: âœ… ëª¨ë“  ë°ì´í„° í¬í•¨ (but change_rate ì—†ìŒ)

[í”„ë¡ íŠ¸ì—”ë“œ ì¡°íšŒ]
  â†“ GET /latest-scan

[DB ì¡°íšŒ] get_latest_scan_from_db()
  â”œâ”€ âŒ create_scan_rank_table() í˜¸ì¶œ ì•ˆ í•¨
  â””â”€ SELECT FROM scan_rank  â† í…Œì´ë¸” ì—†ê±°ë‚˜ ë°ì´í„° ì—†ìœ¼ë©´ ì—ëŸ¬
```
**ì™œ ì¤‘ë³µ ì¡°íšŒ?**
- `it.indicators.VOL` ìˆëŠ”ë° ëª» ì°¾ì•„ì„œ `volume = 0`
- `it.indicators.change_rate` ì—†ì–´ì„œ `change_rate = 0.0`
- ë‘˜ ë‹¤ 0ì´ë‹ˆê¹Œ API ì¬ì¡°íšŒ

#### ë¬¸ì œ 3: DB ì €ì¥ ë¡œì§ ì˜¤ë¥˜ [P1]
**íŒŒì¼**: `backend/main.py` ë¼ì¸ 193-206
**ì¦ìƒ**: volumeê³¼ change_rateê°€ 0ìœ¼ë¡œ ì €ì¥ë¨

```python
def _save_snapshot_db(as_of: str, items: List[ScanItem]):
    for it in items:
        volume = 0  # âŒ í•˜ë“œì½”ë”© (it.indicators.VOL ë¬´ì‹œ)
        change_rate = 0.0  # âŒ í•˜ë“œì½”ë”©

        # API ì¬ì¡°íšŒë¡œ ë®ì–´ì“°ê¸° ì‹œë„í•˜ì§€ë§Œ ì‹¤íŒ¨ ê°€ëŠ¥
        try:
            quote = api.get_stock_quote(it.ticker)
            if "error" not in quote:
                volume = quote.get("volume", volume)
                change_rate = quote.get("change_rate", change_rate)
        except Exception as e:
            pass  # ì‹¤íŒ¨ ì‹œ 0, 0.0ìœ¼ë¡œ ì €ì¥ë¨
```

**ê²°ê³¼:**
- `volume` ì»¬ëŸ¼: 0 ì €ì¥ (ë°ì´í„° ì†ì‹¤)
- `change_rate` ì»¬ëŸ¼: 0.0 ì €ì¥ (ë°ì´í„° ì†ì‹¤)
- `indicators` JSON: VOLì€ í¬í•¨ë˜ì§€ë§Œ change_rateëŠ” ì—†ìŒ

#### ë¬¸ì œ 4: ë“±ë½ë¥ /ê±°ë˜ëŒ€ê¸ˆ í•„ë“œ ëˆ„ë½ [P1]
**íŒŒì¼**: `backend/models.py` ë¼ì¸ 6-17

```python
class IndicatorPayload(BaseModel):
    close: float    # âœ… ì¢…ê°€ ìˆìŒ
    VOL: int        # âœ… ê±°ë˜ëŸ‰ ìˆìŒ
    # âŒ change_rate ì—†ìŒ (ë“±ë½ë¥ )
    # âŒ trading_value ì—†ìŒ (ê±°ë˜ëŒ€ê¸ˆ)

    ### 3. API í˜¸ì¶œ í˜„í™©

**í˜„ì¬:**
```
Universe ì¡°íšŒ:  2ë²ˆ (KOSPI, KOSDAQ top codes)
ìŠ¤ìº” ì‹¤í–‰:     50ë²ˆ (get_ohlcv 220ì¼ì¹˜)
DB ì €ì¥ ì¤‘ë³µ:   5ë²ˆ (get_ohlcv 2ì¼ì¹˜) â† ë¶ˆí•„ìš”
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
í•©ê³„:         57ë²ˆ
```

**ê°œì„  í›„:**
```
Universe ì¡°íšŒ:  2ë²ˆ
ìŠ¤ìº” ì‹¤í–‰:     50ë²ˆ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
í•©ê³„:         52ë²ˆ (5ë²ˆ ì ˆì•½)
```

## âœ… ê°œì„  ë°©ì•ˆ

### ê°œì„  1: DB ì¡°íšŒ ì‹œ í…Œì´ë¸” ìƒì„± ë³´ì¥ [P0 - í•„ìˆ˜]

**ëª©ì **: í”„ë¡ íŠ¸ì—”ë“œ ì¡°íšŒ ì‹œ í…Œì´ë¸” ì—†ìŒ ì—ëŸ¬ ë°©ì§€

**íŒŒì¼**: `backend/main.py`
**í•¨ìˆ˜**: `get_latest_scan_from_db()` (ë¼ì¸ 1537)

**ìˆ˜ì •:**
```python
def get_latest_scan_from_db():
    """DBì—ì„œ ì§ì ‘ ìµœì‹  ìŠ¤ìº” ê²°ê³¼ë¥¼ ì¡°íšŒí•˜ëŠ” í•¨ìˆ˜ (SSRìš©)"""
    try:
        from datetime import datetime

        conn = sqlite3.connect(_db_path())
        cur = conn.cursor()

        # âœ… ì¶”ê°€: í…Œì´ë¸” ìƒì„± ë³´ì¥
        create_scan_rank_table(cur)

        # ì˜¤ëŠ˜ ë‚ ì§œ í™•ì¸
        today = datetime.now().strftime('%Y-%m-%d')
        # ... ê¸°ì¡´ ë¡œì§
```

**íš¨ê³¼:**
- DB ì¡°íšŒ ì „ í…Œì´ë¸” ì¡´ì¬ ë³´ì¥
- `no such table` ì—ëŸ¬ ë°©ì§€
- **ìˆ˜ì • ì†Œìš”: 1ì¤„, 1ë¶„**

---

### ê°œì„  2: ìŠ¤ìº” ì‹œì ì— ë“±ë½ë¥  ê³„ì‚° [P1 - ê¶Œì¥]

**ëª©ì **: API ì¬ì¡°íšŒ ì—†ì´ ë“±ë½ë¥  í™•ë³´

**íŒŒì¼**: `backend/scanner.py`
**í•¨ìˆ˜**: `scan_one_symbol()` (ë¼ì¸ 509-577)

**ìˆ˜ì •:**
```python
def scan_one_symbol(code: str, base_date: str = None, market_condition=None) -> dict:
    from kiwoom_api import api
    df = api.get_ohlcv(code, config.ohlcv_count, base_date)
    # ... ê¸°ì¡´ ë¡œì§

    cur = df.iloc[-1]

    # âœ… ì¶”ê°€: ë“±ë½ë¥  ê³„ì‚° (ì „ì¼ ëŒ€ë¹„)
    change_rate = 0.0
    if len(df) >= 2:
        prev_close = df.iloc[-2]["close"]
        if prev_close > 0:
            change_rate = round(((cur.close - prev_close) / prev_close) * 100, 2)

    return {
        "ticker": code,
        "name": api.get_stock_name(code),
        "match": matched,
        "score": score,
        "indicators": {
            "TEMA": cur.TEMA20,
            "DEMA": cur.DEMA10,
            # ... ê¸°ì¡´ í•„ë“œë“¤
            "close": cur.close,
            "VOL": cur.volume,
            "change_rate": change_rate,  # âœ… ì¶”ê°€
        },
        # ...
    }
```

**ëª¨ë¸ ìˆ˜ì • í•„ìš”:**
```python
# backend/models.py
class IndicatorPayload(BaseModel):
    # ... ê¸°ì¡´ í•„ë“œë“¤
    close: float
    VOL: int
    change_rate: Optional[float] = 0.0  # âœ… ì¶”ê°€
```

**íš¨ê³¼:**
- ë“±ë½ë¥ ì„ ìŠ¤ìº” ì‹œì ì— ê³„ì‚°
- ì´ë¯¸ ì¡°íšŒí•œ 220ì¼ ë°ì´í„° í™œìš©
- API ì¬ì¡°íšŒ ë¶ˆí•„ìš”
- **ìˆ˜ì • ì†Œìš”: 10ë¶„**

---

### ê°œì„  3: DB ì €ì¥ ì‹œ API ì¬ì¡°íšŒ ì œê±° [P1 - ê¶Œì¥]

**ëª©ì **: ì¤‘ë³µ API í˜¸ì¶œ ì œê±°

**íŒŒì¼**: `backend/main.py`
**í•¨ìˆ˜**: `_save_snapshot_db()` (ë¼ì¸ 179-233)

**ë³€ê²½ ì „:**
```python
def _save_snapshot_db(as_of: str, items: List[ScanItem]):
    for it in items:
        close_price = float(getattr(it.indicators, 'close', 0))
        volume = 0  # âŒ ì™œ 0?
        change_rate = 0.0  # âŒ ì™œ 0?

        # API ì¬ì¡°íšŒ
        try:
            quote = api.get_stock_quote(it.ticker)  # âŒ ì¤‘ë³µ í˜¸ì¶œ
            if "error" not in quote:
                close_price = quote.get("current_price", close_price)
                volume = quote.get("volume", volume)
                change_rate = quote.get("change_rate", change_rate)
        except Exception as e:
            pass
```

**ë³€ê²½ í›„:**
```python
def _save_snapshot_db(as_of: str, items: List[ScanItem]):
    for it in items:
        # âœ… ì´ë¯¸ ìˆëŠ” ë°ì´í„° ì‚¬ìš©
        close_price = float(it.indicators.close)
        volume = int(it.indicators.VOL)
        change_rate = float(getattr(it.indicators, 'change_rate', 0.0))
        market = getattr(it, 'market', '')
        strategy = it.strategy

        # âŒ API ì¬ì¡°íšŒ ì œê±°
        # quote = api.get_stock_quote(it.ticker)  # ì‚­ì œ
```

**íš¨ê³¼:**
- API í˜¸ì¶œ 5íšŒ ì ˆì•½
- ì €ì¥ ì†ë„ í–¥ìƒ (ì•½ 2~3ì´ˆ)
- ì½”ë“œ ê°„ê²°í™”
- **ìˆ˜ì • ì†Œìš”: 5ë¶„**

---

### ê°œì„  4: ì—ëŸ¬ ì²˜ë¦¬ ê°•í™” [P2 - ì„ íƒ]

**ëª©ì **: ì €ì¥ ì‹¤íŒ¨ ì›ì¸ íŒŒì•…

**íŒŒì¼**: `backend/main.py`
**í•¨ìˆ˜**: `_save_snapshot_db()` (ë¼ì¸ 179-233)

**ìˆ˜ì •:**
```python
def _save_snapshot_db(as_of: str, items: List[ScanItem]):
    try:
        print(f"ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥ ì‹œì‘: {as_of}, {len(items)}ê°œ í•­ëª©")
        conn = sqlite3.connect(_db_path())
        cur = conn.cursor()
        create_scan_rank_table(cur)

        rows = []
        for it in items:
            try:  # âœ… ì¶”ê°€: ê°œë³„ í•­ëª© ì—ëŸ¬ ì²˜ë¦¬
                close_price = float(it.indicators.close)
                volume = int(it.indicators.VOL)
                change_rate = float(getattr(it.indicators, 'change_rate', 0.0))
                # ... ë°ì´í„° ì¤€ë¹„
                rows.append((as_of, it.ticker, ...))
            except Exception as e:
                print(f"âš ï¸ {it.ticker} ë°ì´í„° ì¤€ë¹„ ì‹¤íŒ¨: {e}")
                continue  # ì‹¤íŒ¨í•œ í•­ëª©ì€ ê±´ë„ˆë›°ê³  ê³„ì†

        if not rows:  # âœ… ì¶”ê°€: ë¹ˆ ë°ì´í„° ì²´í¬
            print(f"âŒ ì €ì¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤")
            return False

        cur.executemany("""
            INSERT OR REPLACE INTO scan_rank(...)
            VALUES (?,?,?,...)
        """, rows)
        conn.commit()
        conn.close()
        print(f"âœ… ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥ ì™„ë£Œ: {len(rows)}ê°œ ì €ì¥ë¨")
        return True

    except Exception as e:
        print(f"âŒ ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥ ì˜¤ë¥˜: {e}")
        import traceback
        traceback.print_exc()  # âœ… ìƒì„¸ ì—ëŸ¬ ì¶œë ¥
        return False
```

**íš¨ê³¼:**
- ì¼ë¶€ í•­ëª© ì‹¤íŒ¨í•´ë„ ë‚˜ë¨¸ì§€ ì €ì¥
- ì €ì¥ ì‹¤íŒ¨ ì‹œ ìƒì„¸ ì •ë³´ ì¶œë ¥
- ë””ë²„ê¹… ìš©ì´
- **ìˆ˜ì • ì†Œìš”: 10ë¶„**

---

### ê°œì„  5: ê±°ë˜ëŒ€ê¸ˆ ê³„ì‚° ì¶”ê°€ [P2 - ì„ íƒ]

**ëª©ì **: ìŠ¤ìºë„ˆ í™”ë©´ì— ê±°ë˜ëŒ€ê¸ˆ í‘œì‹œ

**íŒŒì¼**: `backend/scanner.py`
**í•¨ìˆ˜**: `scan_one_symbol()` (ë¼ì¸ 547-577)

**ìˆ˜ì •:**
```python
# âœ… ì¶”ê°€: ê±°ë˜ëŒ€ê¸ˆ ê³„ì‚° (OHLC í‰ê· ê°€ ì‚¬ìš©)
avg_price = (cur.open + cur.high + cur.low + cur.close) / 4
trading_value = int(avg_price * cur.volume)

return {
    "indicators": {
        # ... ê¸°ì¡´ í•„ë“œë“¤
        "close": cur.close,
        "VOL": cur.volume,
        "change_rate": change_rate,
        "trading_value": trading_value,  # âœ… ì¶”ê°€: ê±°ë˜ëŒ€ê¸ˆ
    }
}
```

**ì°¸ê³ :** ê±°ë˜ëŒ€ê¸ˆ ê³„ì‚°
- âŒ ë¶€ì •í™•: `close Ã— volume` (í•˜ë£¨ ì¤‘ íŠ¹ì • ì‹œì ë§Œ ë°˜ì˜)
- âœ… ê¶Œì¥: `(open + high + low + close) / 4 Ã— volume` (OHLC í‰ê· ê°€)

**ëª¨ë¸ ìˆ˜ì •:**
```python
# backend/models.py
class IndicatorPayload(BaseModel):
    # ... ê¸°ì¡´ í•„ë“œë“¤
    change_rate: Optional[float] = 0.0
    trading_value: Optional[int] = 0  # âœ… ì¶”ê°€
```

**íš¨ê³¼:**
- ê±°ë˜ëŒ€ê¸ˆ ì •ë³´ ì œê³µ
- ì¶”ê°€ API í˜¸ì¶œ ì—†ì´ ê³„ì‚° (OHLC í‰ê· ê°€ Ã— ê±°ë˜ëŸ‰)
- ì¢…ê°€ë§Œ ì‚¬ìš©í•˜ëŠ” ê²ƒë³´ë‹¤ ì •í™•í•œ ê·¼ì‚¬ì¹˜
- **ìˆ˜ì • ì†Œìš”: 5ë¶„**

## ğŸ“Š ìš°ì„ ìˆœìœ„

### P0 - ì¦‰ì‹œ ìˆ˜ì • (í•„ìˆ˜)
**ëª©í‘œ**: ìŠ¤ìºë„ˆ í™”ë©´ ì •ìƒ í‘œì‹œ

1. **ê°œì„  1**: DB ì¡°íšŒ ì‹œ í…Œì´ë¸” ìƒì„± ë³´ì¥
   - ìˆ˜ì •: 1ì¤„
   - ì†Œìš”: 1ë¶„
   - íš¨ê³¼: í…Œì´ë¸” ì—†ìŒ ì—ëŸ¬ ë°©ì§€

### P1 - ì£¼ìš” ê°œì„  (ê¶Œì¥)
**ëª©í‘œ**: API ì¤‘ë³µ ì œê±° + ë°ì´í„° ì •í™•ì„±

2. **ê°œì„  2**: ìŠ¤ìº” ì‹œì ì— ë“±ë½ë¥  ê³„ì‚°
   - ìˆ˜ì •: scanner.py, models.py
   - ì†Œìš”: 10ë¶„
   - íš¨ê³¼: ë“±ë½ë¥  ì •í™•í•œ ê³„ì‚°

3. **ê°œì„  3**: DB ì €ì¥ ì‹œ API ì¬ì¡°íšŒ ì œê±°
   - ìˆ˜ì •: main.py (_save_snapshot_db)
   - ì†Œìš”: 5ë¶„
   - íš¨ê³¼: API 5íšŒ ì ˆì•½, ì†ë„ í–¥ìƒ

### P2 - ì¶”ê°€ ê°œì„  (ì„ íƒ)
**ëª©í‘œ**: ì•ˆì •ì„± + ê¸°ëŠ¥ í™•ì¥

4. **ê°œì„  4**: ì—ëŸ¬ ì²˜ë¦¬ ê°•í™”
   - ìˆ˜ì •: main.py (_save_snapshot_db)
   - ì†Œìš”: 10ë¶„
   - íš¨ê³¼: ë””ë²„ê¹… ìš©ì´

5. **ê°œì„  5**: ê±°ë˜ëŒ€ê¸ˆ ê³„ì‚° ì¶”ê°€
   - ìˆ˜ì •: scanner.py, models.py
   - ì†Œìš”: 5ë¶„
   - íš¨ê³¼: ê±°ë˜ëŒ€ê¸ˆ ì •ë³´ ì œê³µ

## ğŸ”§ êµ¬í˜„ ìˆœì„œ

### 1ë‹¨ê³„: P0 ìˆ˜ì • (1ë¶„)
```bash
# 1. get_latest_scan_from_db() ìˆ˜ì •
# íŒŒì¼: backend/main.py ë¼ì¸ 1543

# ìˆ˜ì • ì „:
conn = sqlite3.connect(_db_path())
cur = conn.cursor()

# ìˆ˜ì • í›„:
conn = sqlite3.connect(_db_path())
cur = conn.cursor()
create_scan_rank_table(cur)  # â† ì´ ë¼ì¸ ì¶”ê°€
```

### 2ë‹¨ê³„: í…ŒìŠ¤íŠ¸ (5ë¶„)
```bash
# ë°±ì—”ë“œ ì¬ì‹œì‘
cd backend
python main.py

# í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ìŠ¤ìºë„ˆ í˜ì´ì§€ ì ‘ì†
# â†’ ë‚ ì§œ/ì¢…ê°€ê°€ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸
```

### 3ë‹¨ê³„: P1 ìˆ˜ì • (15ë¶„)
```bash
# 1. models.py ìˆ˜ì • - change_rate í•„ë“œ ì¶”ê°€
# 2. scanner.py ìˆ˜ì • - ë“±ë½ë¥  ê³„ì‚° ì¶”ê°€
# 3. main.py ìˆ˜ì • - API ì¬ì¡°íšŒ ì œê±°
```

### 4ë‹¨ê³„: ì „ì²´ í…ŒìŠ¤íŠ¸ (10ë¶„)
```bash
# ìŠ¤ìº” ì‹¤í–‰
curl "http://localhost:8010/scan?save_snapshot=true"

# DB í™•ì¸
cd backend
sqlite3 snapshots.db "SELECT date, code, name, close_price, volume, change_rate FROM scan_rank ORDER BY date DESC LIMIT 5"

# API ì‘ë‹µ í™•ì¸
curl "http://localhost:8010/latest-scan" | jq '.data.items[0].indicators'
```

## ğŸ“ í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

### P0 í…ŒìŠ¤íŠ¸
- [ ] `/latest-scan` API í˜¸ì¶œ ì‹œ ì—ëŸ¬ ì—†ì´ ì‘ë‹µ
- [ ] í”„ë¡ íŠ¸ì—”ë“œ ìŠ¤ìºë„ˆ í˜ì´ì§€ì— ë‚ ì§œ ì •ìƒ í‘œì‹œ
- [ ] ì¢…ê°€/ê±°ë˜ëŸ‰ ì •ìƒ í‘œì‹œ

### P1 í…ŒìŠ¤íŠ¸
- [ ] ìŠ¤ìº” ê²°ê³¼ì— ë“±ë½ë¥ (`change_rate`) í¬í•¨
- [ ] DBì— ë“±ë½ë¥  ì €ì¥ í™•ì¸
- [ ] API í˜¸ì¶œ íšŸìˆ˜ í™•ì¸ (57â†’52 ê°ì†Œ)
- [ ] ìŠ¤ìº” ì‹¤í–‰ ì‹œê°„ ì¸¡ì • (ì•½ 2~3ì´ˆ ë‹¨ì¶•)

### P2 í…ŒìŠ¤íŠ¸
- [ ] ì—ëŸ¬ ë°œìƒ ì‹œ ìƒì„¸ ë¡œê·¸ ì¶œë ¥
- [ ] ì¼ë¶€ ì¢…ëª© ì‹¤íŒ¨í•´ë„ ë‚˜ë¨¸ì§€ ì €ì¥ í™•ì¸
- [ ] ê±°ë˜ëŒ€ê¸ˆ ê³„ì‚° ì •í™•ì„± í™•ì¸

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. ê¸°ì¡´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
í˜„ì¬ `snapshots.db`ê°€ ë¹„ì–´ìˆê±°ë‚˜ ë°ì´í„°ê°€ ë¶€ì¡±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**í•´ê²°ì±… A**: JSON íŒŒì¼ì„ DBë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜
```bash
curl -X POST http://localhost:8010/snapshots/backfill
```

**í•´ê²°ì±… B**: ìƒˆë¡œ ìŠ¤ìº” ì‹¤í–‰
```bash
curl "http://localhost:8010/scan?save_snapshot=true"
```

### 2. ëª¨ë¸ ë³€ê²½ ì‹œ í˜¸í™˜ì„±
`IndicatorPayload`ì— `change_rate` í•„ë“œ ì¶”ê°€ ì‹œ:
- `Optional[float] = 0.0`ìœ¼ë¡œ ê¸°ë³¸ê°’ ì„¤ì •
- ê¸°ì¡´ ë°ì´í„°ë„ ì¡°íšŒ ê°€ëŠ¥í•˜ë„ë¡ ë³´ì¥

### 3. ì—ëŸ¬ ë¡œê·¸ ëª¨ë‹ˆí„°ë§
ìˆ˜ì • í›„ ë°±ì—”ë“œ ë¡œê·¸ í™•ì¸:
```bash
tail -f backend/backend.log
```

ë‹¤ìŒ ë©”ì‹œì§€ í™•ì¸:
- `âœ… ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥ ì™„ë£Œ: Nê°œ ì €ì¥ë¨`
- `âŒ ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥ ì˜¤ë¥˜: ...` (ìˆìœ¼ë©´ ì•ˆ ë¨)

### 4. ì£½ì€ ì½”ë“œ ì •ë¦¬ (ì„ íƒ)
í˜„ì¬ `enhanced_rank`ì™€ `snapshot` ë”•ì…”ë„ˆë¦¬ë¥¼ ìƒì„±í•˜ì§€ë§Œ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ:
```python
# backend/main.py ë¼ì¸ 385-454
# ì´ ë¶€ë¶„ì€ ì‚­ì œ ê°€ëŠ¥ (JSON íŒŒì¼ ì €ì¥ ì•ˆ í•¨)
enhanced_rank = []  # â† ìƒì„±ë§Œ í•˜ê³  ì‚¬ìš© ì•ˆ í•¨
snapshot = {...}     # â† ìƒì„±ë§Œ í•˜ê³  ì‚¬ìš© ì•ˆ í•¨
```

ì •ë¦¬í•˜ë©´:
- API ì¬ì¡°íšŒ 5ë²ˆ ì œê±°
- ë¶ˆí•„ìš”í•œ ë°ì´í„° ê°€ê³µ ì œê±°
- ì½”ë“œ ì•½ 70ì¤„ ê°ì†Œ

## ğŸ¯ ê¸°ëŒ€ íš¨ê³¼

### P0 ì ìš© ì‹œ (í•„ìˆ˜)
- âœ… ìŠ¤ìºë„ˆ í™”ë©´ ì •ìƒ í‘œì‹œ
- âœ… ë‚ ì§œ/ì¢…ê°€ ì •ìƒ ì¡°íšŒ
- âœ… í”„ë¡ íŠ¸ì—”ë“œ ì—ëŸ¬ í•´ê²°

### P1 ì ìš© ì‹œ (ê¶Œì¥)
- âœ… API í˜¸ì¶œ 57â†’52íšŒ (9% ê°ì†Œ)
- âœ… ì €ì¥ ì‹œê°„ 2~3ì´ˆ ë‹¨ì¶•
- âœ… ë“±ë½ë¥  ì •í™•í•œ ê³„ì‚° ë° ì €ì¥
- âœ… ê±°ë˜ëŸ‰ ì •ìƒ ì €ì¥ (í˜„ì¬ 0ìœ¼ë¡œ ì €ì¥ë˜ëŠ” ë¬¸ì œ í•´ê²°)
- âœ… ê±°ë˜ëŒ€ê¸ˆ ê³„ì‚° ë° ì €ì¥
- âœ… ì½”ë“œ ê°„ê²°í™”

### P2 ì ìš© ì‹œ (ì„ íƒ)
- âœ… ì—ëŸ¬ ì¶”ì  ìš©ì´
- âœ… ì•ˆì •ì„± í–¥ìƒ
- âœ… ì£½ì€ ì½”ë“œ ì œê±° (ì•½ 70ì¤„)

## ğŸ“Œ ìš”ì•½

| ê°œì„  | ìš°ì„ ìˆœìœ„ | ì†Œìš” ì‹œê°„ | íš¨ê³¼ |
|------|---------|----------|------|
| ê°œì„  1 | P0 | 1ë¶„ | í™”ë©´ í‘œì‹œ ì •ìƒí™” (í•„ìˆ˜) |
| ê°œì„  2 | P1 | 10ë¶„ | ë“±ë½ë¥  ê³„ì‚° |
| ê°œì„  3 | P1 | 5ë¶„ | API 5íšŒ ì ˆì•½ |
| ê°œì„  4 | P2 | 10ë¶„ | ì—ëŸ¬ ì¶”ì  ê°•í™” |
| ê°œì„  5 | P2 | 5ë¶„ | ê±°ë˜ëŒ€ê¸ˆ í‘œì‹œ |
| **í•©ê³„** | - | **31ë¶„** | **ì™„ì „ í•´ê²°** |

**ìµœì†Œ êµ¬í˜„**: P0ë§Œ (1ë¶„) - í™”ë©´ í‘œì‹œë§Œ ë³µêµ¬
**ê¶Œì¥ êµ¬í˜„**: P0 + P1 (16ë¶„) - ë°ì´í„° ì •í™•ì„±ê¹Œì§€ í™•ë³´
**ì™„ì „ êµ¬í˜„**: ì „ì²´ (31ë¶„) - ì•ˆì •ì„± + ì½”ë“œ í’ˆì§ˆ

## âš ï¸ ì¤‘ìš”: í˜„ì¬ DB ì €ì¥ ìƒíƒœ

**í˜„ì¬ ë¬¸ì œ:**
```sql
-- ì‹¤ì œ ì €ì¥ë˜ëŠ” ë°ì´í„°
SELECT close_price, volume, change_rate FROM scan_rank;
-- 54600, 0, 0.0  â† volumeê³¼ change_rateê°€ 0!
```

**ì›ì¸:**
- `volume = 0`ìœ¼ë¡œ í•˜ë“œì½”ë”© (it.indicators.VOL ë¬´ì‹œ)
- `change_rate = 0.0`ìœ¼ë¡œ í•˜ë“œì½”ë”© (ê³„ì‚° ì•ˆ í•¨)
- API ì¬ì¡°íšŒë¡œ ë³µêµ¬ ì‹œë„í•˜ì§€ë§Œ ì‹¤íŒ¨ ì‹œ 0 ìœ ì§€

**ê°œì„  í•„ìˆ˜:**
- P1 ê°œì„  2, 3ì„ ì ìš©í•´ì•¼ ì •í™•í•œ ë°ì´í„° ì €ì¥
- ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ volumeê³¼ change_rateê°€ ê³„ì† 0ìœ¼ë¡œ ì €ì¥ë¨
# 스캔 로직 분석 및 개선 방안

## 현재 스캔 로직의 문제점

### 1. 검증 결과 요약

**현재 전략 (손절 -7%, 익절 +3%, 보존 +1.5%)**
- 익절: 61.3% (212개)
- 손절: 22.5% (78개)
- 승률: 68.0%
- 평균 수익률: +0.71%
- 손익비: 0.58:1 ⚠️ (평균 손실이 평균 수익보다 큼)

**전략 A (손절 -5%, 익절 +8%, 보존 +3%)**
- 익절: 39.0% (135개)
- 손절: 48.8% (169개)
- 승률: 45.5%
- 평균 수익률: +1.43%
- 손익비: 1.58:1 ✅ (개선되었지만 여전히 낮음)

### 2. 핵심 문제

1. **손익비가 낮음**
   - 현재 전략: 0.58:1 (평균 손실이 평균 수익보다 1.7배 큼)
   - 목표: 최소 2:1 이상 필요

2. **평균 수익률이 낮음**
   - 현재 전략: +0.71% (거의 손익분기)
   - 전략 A: +1.43% (여전히 낮음)

3. **스캔 로직의 문제 가능성**
   - 기술적 지표만으로는 충분하지 않음
   - 추세 초입 신호가 실제로는 후행 지표일 수 있음
   - 시장 타이밍 고려 부족

## 현재 스캔 로직 분석

### 사용하는 지표

1. **골든크로스**: TEMA20 > DEMA10 (상승 초입 신호)
2. **MACD**: 골든크로스 또는 상승 모멘텀
3. **RSI**: TEMA > DEMA 또는 수렴 후 상승
4. **거래량**: MA5 대비 1.8배 이상 급증
5. **추세 필터**: TEMA 슬로프 > 0, OBV 슬로프 > 0
6. **과열 필터**: RSI >= 70 & 거래량 3배 이상

### 문제점

1. **후행 지표 의존**
   - 골든크로스는 이미 상승한 후 발생
   - 실제 매수 시점은 이미 상승한 상태

2. **추세 초입 신호의 한계**
   - 상승 초입은 진짜 시작일 수도, 반등 후 하락일 수도 있음
   - 성공 확률이 낮음

3. **필터링 기준이 약함**
   - 최소 신호 2개만 요구 (너무 관대)
   - 스코어 2점 이상이면 매칭 (너무 낮음)

4. **시장 타이밍 부재**
   - 강세장/약세장 구분은 하지만, 개별 종목 타이밍 부족
   - 전체 시장 흐름 대비 개별 종목 강도 분석 부족

5. **리스크 관리 부족**
   - 위험도 점수는 있지만, 실제 수익 예측 지표 부족
   - 과거 성과 기반 필터링 없음

## 개선 방안

### 1. 즉시 적용 가능한 개선

#### A. 스코어 임계값 상향
- **현재**: 스코어 2점 이상 → 매칭
- **개선**: 스코어 6점 이상 → 매칭 (강한 신호만)
- **효과**: 저품질 종목 제거, 승률 향상 기대

#### B. 최소 신호 개수 상향
- **현재**: 최소 2개 신호 요구
- **개선**: 최소 3개 신호 요구
- **효과**: 더 확실한 신호만 선택

#### C. 거래량 조건 강화
- **현재**: MA5 대비 1.8배
- **개선**: MA5 대비 2.5배 + MA20 대비 1.5배
- **효과**: 진짜 자금 유입만 선택

#### D. 추세 필터 강화
- **현재**: TEMA 슬로프 > 0, OBV 슬로프 > 0
- **개선**: TEMA 슬로프 > 0.001, OBV 슬로프 > 0.001 (더 강한 추세)
- **효과**: 약한 추세 제거

### 2. 중기 개선 방안

#### A. 과거 성과 기반 필터링 추가
- 스캔 후 1주일 내 평균 수익률이 양수인 종목만 선택
- 스코어 상위 종목의 과거 성과 확인

#### B. 상대 강도 지표 추가
- 시장 대비 상대 강도 (RS) 계산
- RS > 1.0인 종목만 선택 (시장보다 강한 종목)

#### C. 섹터/테마 분석 추가
- 섹터별 강도 분석
- 강한 섹터의 종목만 선택

#### D. 가격 액션 패턴 추가
- 상승 추세 확인 (최근 20일 고점/저점 상승)
- 거래량 증가와 함께 가격 상승 확인

### 3. 장기 개선 방안

#### A. 머신러닝 모델 도입
- 과거 성과 데이터로 학습
- 스코어 + ML 예측 점수 결합

#### B. 다중 시간대 분석
- 일봉 + 주봉 분석
- 장기 추세 확인

#### C. 펀더멘털 지표 결합
- 재무 지표 (ROE, ROA, PER 등)
- 성장성 지표 (매출 성장률, 이익 성장률)

## 추천 즉시 개선 사항

### 우선순위 1: 스코어 임계값 상향
```python
# 현재: score >= 2
# 개선: score >= 6 (강한 매수 신호만)
if score >= 6:
    flags["label"] = "강한 매수"
    flags["match"] = True
```

### 우선순위 2: 최소 신호 개수 상향
```python
# 현재: min_signals = 2
# 개선: min_signals = 3
if signals_true < 3 or not trend_ok:
    return False, signals_true, 3
```

### 우선순위 3: 거래량 조건 강화
```python
# 현재: volume >= vol_ma5_mult * VOL_MA5 (1.8배)
# 개선: volume >= 2.5 * VOL_MA5 AND volume >= 1.5 * VOL_MA20
volx = (cur.volume >= 2.5 * cur.VOL_MA5) and \
       (cur.volume >= 1.5 * df["volume"].iloc[-20:].mean())
```

### 우선순위 4: 추세 필터 강화
```python
# 현재: TEMA20_SLOPE20 > 0
# 개선: TEMA20_SLOPE20 > 0.001 (더 강한 추세)
tema_slope_ok = (float(df.iloc[-1]["TEMA20_SLOPE20"]) > 0.001) and (cur.close > cur.TEMA20)
```

## 예상 개선 효과

### 개선 전
- 익절: 61.3%
- 승률: 68.0%
- 평균 수익률: +0.71%
- 손익비: 0.58:1

### 개선 후 (예상)
- 익절: 45~55% (하락, 하지만 품질 향상)
- 승률: 75~80% (상승)
- 평균 수익률: +1.5~2.5% (상승)
- 손익비: 1.2~1.5:1 (개선)

## 결론

현재 스캔 로직은 **너무 관대한 필터링**으로 인해 저품질 종목이 포함되고 있습니다.

**즉시 적용 가능한 개선:**
1. 스코어 임계값 6점 이상으로 상향
2. 최소 신호 개수 3개로 상향
3. 거래량 조건 강화
4. 추세 필터 강화

이를 통해 **품질은 높이고, 수량은 줄이는** 전략으로 전환하면 손익비와 평균 수익률이 개선될 것으로 예상됩니다.


# 캐시 데이터 정합성 검증 리포트

**검증 일시**: 2025-11-28  
**검증 범위**: 레짐 분석에 사용되는 모든 캐시 데이터

---

## 📊 검증 결과 요약

| 데이터 | 상태 | 문제점 | 심각도 |
|--------|------|--------|--------|
| KOSPI | ❌ **비정상** | ETF 데이터 사용, R20 비정상적 | **높음** |
| KOSDAQ | ✅ 정상 | - | - |
| SPY | ✅ 정상 | - | - |
| QQQ | ✅ 정상 | - | - |
| VIX | ❌ **비정상** | 단위 오류 (10배) | **높음** |

---

## 1. KOSPI 데이터 검증

### 현재 상태
- **파일**: `data_cache/kospi200_ohlcv.pkl`
- **데이터 개수**: 1,452개
- **기간**: 2020-01-02 ~ 2025-11-28
- **최근 종가**: 55,650.00

### 문제점

#### 1.1 데이터 소스 오류
- **문제**: 실제 KOSPI 지수가 아닌 **KOSPI200 ETF(069500)** 데이터 사용
- **증거**:
  - 캐시 종가: 55,650원 (ETF 가격)
  - 실제 KOSPI 지수: 약 3,500~4,000 포인트
  - 차이: 약 **15배**

#### 1.2 R20 값 비정상
- **7월 데이터 분석**:
  - 캐시(ETF) R20 평균: **17.44%** (최대: 23.52%)
  - 실제 지수 R20 평균: **12.65%** (최대: 18.96%)
  - 차이: 약 **5%p**

- **비정상 패턴**:
  - 모든 7월 날짜에서 R20 > 10%
  - 실제 지수도 7월에 R20이 높았지만, ETF는 더 높게 나타남

#### 1.3 영향
- 레짐 분석의 한국 Trend Score가 부정확
- R20 기반 레짐 판단 오류
- 스캐너 추천 종목 수 오류

---

## 2. KOSDAQ 데이터 검증

### 현재 상태
- **파일**: `data_cache/ohlcv/229200.csv`
- **데이터 개수**: 388개
- **기간**: 2024-04-24 ~ 2025-11-28
- **최근 종가**: 15,900.00

### 검증 결과
- ✅ 데이터 범위 정상 (10,000~20,000)
- ✅ R20 계산 정상
- ✅ 일일 변동률 정상

---

## 3. 미국 시장 데이터 검증

### 3.1 SPY 데이터
- **파일**: `data_cache/spy_ohlcv.pkl`
- **데이터 개수**: 1,538개
- **기간**: 2020-01-01 ~ 2025-11-21
- **최근 종가**: 2,806.06
- ✅ **정상**

### 3.2 QQQ 데이터
- **파일**: `data_cache/qqq_ohlcv.pkl`
- **데이터 개수**: 1,538개
- **기간**: 2020-01-01 ~ 2025-11-21
- **최근 종가**: 2,455.30
- ✅ **정상**

### 3.3 VIX 데이터
- **파일**: `data_cache/vix_ohlcv.pkl`
- **데이터 개수**: 1,538개
- **기간**: 2020-01-01 ~ 2025-11-21
- **최근 종가**: 140.30

#### 문제점
- **단위 오류**: 캐시 데이터가 실제 VIX 값의 **10배**로 저장됨
- **증거**:
  - 캐시: 140.30
  - 실제 (yfinance): 16.35
  - 캐시/10 = 14.03 (실제와 유사)

#### 영향
- 레짐 분석의 미국 Risk Score가 부정확
- VIX 기반 리스크 판단 오류
- 글로벌 레짐 결정 오류

---

## 4. 상세 비교 분석

### 4.1 7월 KOSPI R20 비교

| 날짜 | 실제 지수 R20 | 캐시(ETF) R20 | 차이 |
|------|--------------|---------------|------|
| 2025-07-25 | 11.92% | 11.93% | 0.02%p |
| 2025-07-31 | 10.14% | 10.73% | 0.59%p |

**평균 차이**: 약 5%p

### 4.2 통계 비교

**실제 KOSPI 지수 (7월)**:
- R20 평균: 12.65%
- R20 표준편차: 2.58%
- |R20| > 10%: 9개 날짜

**캐시(ETF) (7월)**:
- R20 평균: 17.44%
- R20 표준편차: 4.23%
- |R20| > 10%: 23개 날짜 (모든 날짜)

---

## 5. 권장 사항

### 5.1 즉시 조치 필요 (높은 우선순위)

#### 1. KOSPI 데이터 교체
- **현재**: KOSPI200 ETF(069500) 데이터 사용
- **권장**: 실제 KOSPI 지수 데이터 사용
- **방법**:
  ```python
  # pykrx 사용 (우선)
  from pykrx import stock
  df = stock.get_index_ohlcv_by_date(start_date, end_date, "1001")
  
  # 또는 FinanceDataReader 사용 (fallback)
  import FinanceDataReader as fdr
  df = fdr.DataReader('KS11', start_date, end_date)
  ```
- **작업**: `kospi200_ohlcv.pkl` 파일 재생성

#### 2. VIX 데이터 수정
- **현재**: 단위 오류 (10배)
- **권장**: 캐시 데이터를 10으로 나누어 수정
- **방법**:
  ```python
  vix_df['close'] = vix_df['close'] / 10
  vix_df['open'] = vix_df['open'] / 10
  vix_df['high'] = vix_df['high'] / 10
  vix_df['low'] = vix_df['low'] / 10
  ```
- **작업**: `vix_ohlcv.pkl` 파일 수정

### 5.2 개선 권장 (중간 우선순위)

#### 1. 미국 시장 데이터 최신화
- SPY, QQQ, VIX 데이터가 2025-11-21까지 (7일 지연)
- 정기적인 데이터 업데이트 필요

#### 2. 정기적인 캐시 데이터 검증
- 주간 또는 월간 자동 검증 스크립트 실행
- 이상치 자동 감지 및 알림

#### 3. 데이터 소스 명확화
- 캐시 파일명에 데이터 소스 명시
- 예: `kospi_index_ohlcv.pkl` (지수), `kospi200_etf_ohlcv.pkl` (ETF)

---

## 6. 영향 분석

### 6.1 레짐 분석 영향

**KOSPI 데이터 오류**:
- 한국 Trend Score 부정확
- R20 기반 레짐 판단 오류
- KOSPI/KOSDAQ 분리 신호 감지 오류

**VIX 데이터 오류**:
- 미국 Risk Score 부정확
- 글로벌 레짐 결정 오류
- crash 레짐 판단 오류

### 6.2 스캐너 영향

- 레짐 기반 RSI 임계값 조정 오류
- 추천 종목 수 오류
- 투자 전략 오류

---

## 7. 검증 스크립트

다음 스크립트를 정기적으로 실행하여 캐시 데이터를 검증하세요:

```python
# backend/validate_cache_data.py
# (위 검증 스크립트 참조)
```

---

## 8. 결론

**현재 상태**: 캐시 데이터에 **심각한 정합성 문제** 존재
- KOSPI: ETF 데이터 사용 (실제 지수 아님)
- VIX: 단위 오류 (10배)

**조치 필요**: 즉시 데이터 교체/수정 필요
- 레짐 분석 정확도에 직접적 영향
- 투자 전략 오류 가능성

**예상 효과**: 데이터 교체 후
- 레짐 분석 정확도 향상
- 스캐너 추천 정확도 향상
- 투자 전략 신뢰도 향상


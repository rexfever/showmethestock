# 신호 충족 vs 점수 부족 설명

## 🔍 문제 상황

**"신호는 충족하지만 점수 부족"**이라는 표현의 의미:

- **match_stats**: 통과 ✅ (신호 3개 이상 + 추세 조건 충족)
- **score_conditions**: 실패 ❌ (점수 10점 미만)

## 📊 두 함수의 차이

### 1. match_stats (신호 개수 체크)

**목적**: 신호 개수와 추세 조건만 확인

**체크 항목:**
- 신호 개수: 3개 이상 충족?
- 추세 조건 (trend_ok): 충족?
  - TEMA20_SLOPE20 > 0
  - OBV_SLOPE20 > 0
  - above_cnt >= 3

**반환값:**
- `True`: 신호 3개 이상 + 추세 조건 충족
- `False`: 신호 부족 또는 추세 조건 미충족

**특징:**
- 신호가 있으면 카운트만 함 (점수 계산 없음)
- 예: 신호 3개 = 통과, 신호 4개 = 통과 (동일)

### 2. score_conditions (점수 계산)

**목적**: 각 조건별로 점수를 계산하고 합산

**점수 가중치:**
- 골든크로스 (cross): **3점**
- 거래량 (volume): **2점**
- MACD: **1점**
- RSI: **1점**
- TEMA slope: **2점**
- OBV slope: **2점**
- above_cnt: **2점**

**최대 가능 점수**: 15점

**반환값:**
- 점수 (int): 0 ~ 15점
- flags['match']: 점수 기준 충족 여부

**특징:**
- 각 조건이 충족되면 해당 가중치만큼 점수 획득
- 예: 골든크로스만 충족 = 3점, 거래량만 충족 = 2점

## ⚠️ 왜 불일치가 발생하는가?

### 예시 상황

**종목 A:**
- 신호: 골든크로스 ✅, MACD ✅, RSI ✅ (3개 충족)
- 추세 조건: 모두 충족 ✅
- **match_stats**: 통과 ✅

**하지만 점수 계산:**
- 골든크로스: +3점
- MACD: +1점
- RSI: +1점
- 거래량: ❌ (2.5배 미만) → 0점
- TEMA slope: ❌ → 0점
- OBV slope: ❌ → 0점
- above_cnt: ❌ → 0점
- **총점: 5점** (10점 미만)

**결과:**
- match_stats: 통과 ✅
- score_conditions: 실패 ❌ (5점 < 10점)

## 📈 실제 데이터

### match_stats 통과 종목의 점수 분포

- **최소**: 0.00점
- **최대**: 8.00점
- **평균**: 1.11점
- **중간값**: 0.00점

**점수 기준별 통과율:**
- 10점 이상: **0%** (0개)
- 8점 이상: **10.5%** (2개/19개)
- 6점 이상: **10.5%** (2개/19개)

## 💡 문제점

### 1. 신호 개수 ≠ 점수

- 신호 3개 충족 = match_stats 통과
- 하지만 점수는 3점일 수도 있음 (예: MACD 1점 + RSI 1점 + OBV 2점 = 4점)

### 2. 점수 기준이 너무 높음

- Step 0-1: 10점 이상 필요
- 실제 평균 점수: 1.11점
- 최대 점수: 8점

### 3. 점수 가중치 불균형

- 골든크로스: 3점 (가장 높음)
- 거래량: 2점
- 나머지: 1~2점

**의미:**
- 골든크로스가 없으면 10점 달성 어려움
- 골든크로스만 있어도 3점 (하지만 10점은 불가능)

## 🔧 해결 방안

### 1. 점수 기준 완화

**현재:**
- Step 0-1: 10점 이상
- Step 2-3: 8점 이상

**권장:**
- Step 0-1: 6점 이상 (10점 → 6점)
- Step 2-3: 4점 이상 (8점 → 4점)

### 2. 점수 가중치 조정

- 모든 신호에 동일한 가중치 부여 (예: 각 2점)
- 또는 신호 개수에 비례한 보너스 점수 추가

### 3. 신호 개수 기반 점수 보너스

- 신호 3개: +0점
- 신호 4개: +2점
- 신호 5개: +4점
- 신호 6개 이상: +6점

## 요약

**"신호는 충족하지만 점수 부족"**의 의미:

1. **match_stats**: 신호 개수만 체크 → 통과 ✅
2. **score_conditions**: 각 조건별 점수 계산 → 실패 ❌ (10점 미만)

**원인:**
- 신호 개수와 점수는 별개
- 점수 기준이 너무 높음 (10점)
- 실제 평균 점수는 1.11점

**해결:**
- 점수 기준 완화 (10점 → 6점)
- 또는 점수 계산 로직 개선


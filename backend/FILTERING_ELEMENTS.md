# 필터링 요소 목록

## 11월 17일 스캔 필터링 현황

### 실제 차단 현황 (샘플 100개 기준)

1. **RSI 상한선 초과 (70)**: 83.3% (35개)
   - 가장 큰 차단 요인
   - RSI_TEMA > 70인 종목 즉시 제외

2. **인버스 ETF**: 9.5% (4개)
   - 인버스, 레버리지, 2X 등 키워드 포함 종목 제외

3. **채권 ETF**: 7.1% (3개)
   - 금리, 채권, 국채 등 키워드 포함 종목 제외

4. **신호 부족**: (match=False로 차단된 대부분)
   - min_signals: 3개 이상 필요
   - 골든크로스, MACD, RSI, 거래량 신호 중 3개 이상 충족 필요

5. **갭/이격 초과**: (현재 2.5%로 완화됨)
   - gap_max: 2.5% (중립장)
   - ext_from_tema20_max: 2.5%

6. **유동성 부족**: (거의 없음)
   - 최근 20일 평균 거래대금 < 10억원

7. **저가 종목**: (거의 없음)
   - 현재가 < 2,000원

8. **과열**: (거의 없음)
   - RSI >= 70 AND 거래량 >= 3배

9. **위험 종목**: (거의 없음)
   - risk_score >= 임계값

## 하드 필터 목록 (즉시 제외)

### 1. 데이터 필터
- **조건**: `df.empty` 또는 `len(df) < 21` 또는 NaN 포함
- **위치**: `scan_one_symbol` 시작 부분
- **현재 상태**: 정상 (100% 데이터 있음)

### 2. 인버스 ETF 필터
- **조건**: 종목명에 "인버스", "2X", "레버리지", "SHORT", "BEAR", "DOWN" 포함
- **위치**: `scan_one_symbol` (라인 540-542)
- **현재 상태**: 9.5% 차단 (정상)

### 3. 채권 ETF 필터
- **조건**: 종목명에 "금리", "채권", "국채", "KRX금현물" 포함
- **위치**: `scan_one_symbol` (라인 544-546)
- **현재 상태**: 7.1% 차단 (정상)

### 4. RSI 상한선 필터 ⚠️ **가장 큰 문제**
- **조건**: `RSI_TEMA > 70`
- **위치**: `scan_one_symbol` (라인 567-570)
- **현재 상태**: **83.3% 차단** (너무 엄격)
- **해결 방안**: 70 → 75 또는 80으로 완화 필요

### 5. 유동성 필터
- **조건**: 최근 20일 평균 거래대금 < 10억원
- **위치**: `match_stats` (라인 102-105), `score_conditions` (라인 240-248)
- **현재 상태**: 거의 차단 없음

### 6. 가격 필터
- **조건**: 현재가 < 2,000원
- **위치**: `match_stats` (라인 108-109), `score_conditions` (라인 250-257)
- **현재 상태**: 거의 차단 없음

### 7. 과열 필터
- **조건**: `RSI_TEMA >= 70 AND volume >= 3.0 * VOL_MA5`
- **위치**: `match_stats` (라인 116-122), `score_conditions` (라인 259-271)
- **현재 상태**: 거의 차단 없음 (RSI 상한선에서 먼저 걸림)

### 8. 갭/이격 필터
- **조건**: 
  - `gap_now < gap_min` (0.1%) 또는 `gap_now > gap_max` (2.5%)
  - `ext_pct > ext_from_tema20_max` (2.5%)
- **위치**: `match_stats` (라인 124-128), `score_conditions` (라인 273-286)
- **현재 상태**: 2.5%로 완화됨 (이전 1.8%에서 완화)

### 9. ATR 필터 (변동성)
- **조건**: `atr_pct < 1%` 또는 `atr_pct > 4%` (use_atr_filter가 True일 때)
- **위치**: `match_stats` (라인 130-136), `score_conditions` (라인 288-300)
- **현재 상태**: **비활성화됨** (use_atr_filter: False)

### 10. 위험도 필터
- **조건**: `risk_score >= config.risk_score_threshold`
- **위치**: `score_conditions` (라인 302-313)
- **현재 상태**: 거의 차단 없음

## 소프트 필터 (점수 반영)

### 1. 신호 개수 필터 ⚠️ **두 번째 문제**
- **조건**: `signals_true < min_signals` (기본값 3)
- **위치**: `score_conditions` (라인 454-468)
- **현재 상태**: 대부분 종목이 2개만 충족 (3개 필요)
- **해결 방안**: min_signals 3 → 2로 완화 (Step 3에서 이미 2로 완화하지만 반영 안 됨)

### 2. 거래량 필터
- **조건**: `volume < vol_ma5_mult * VOL_MA5` (기본값 2.5배)
- **위치**: `match_stats` (라인 151), `score_conditions` (신호 계산)
- **현재 상태**: Fallback에서 완화됨 (Step 1: 2.0배, Step 3: 1.8배)

### 3. RSI 임계값 필터
- **조건**: `RSI_TEMA < rsi_threshold` (기본값 58)
- **위치**: `match_stats` (라인 145-147)
- **현재 상태**: 시장 상황에 따라 동적 조정됨

## 11월 17일 스캔 0개 원인

### 주요 원인 (우선순위)

1. **RSI 상한선 필터 (70)**: 83.3% 차단
   - 대부분 종목이 RSI 70 초과
   - **해결**: 70 → 75 또는 80으로 완화

2. **신호 개수 필터 (min_signals: 3)**: 나머지 대부분 차단
   - 대부분 종목이 2개만 충족
   - **해결**: 기본값을 2로 변경 또는 Step 0에서도 2로 시작

3. **갭/이격 필터**: 이미 2.5%로 완화됨 (문제 없음)

4. **ATR 필터**: 비활성화됨 (문제 없음)

## 권장 조치

### 즉시 조치
1. **RSI 상한선 완화**: 70 → 75 또는 80
2. **min_signals 기본값 완화**: 3 → 2

### 추가 검토
1. RSI 상한선을 장세별로 차별화 (강세장: 80, 중립장: 75, 약세장: 70)
2. min_signals를 장세별로 차별화 (강세장: 2, 중립장: 3, 약세장: 4)


# 모든 필터 상세 목록

## 서버 실제 설정값 (2025-11-17 기준)

### 1. RSI 관련 필터

#### RSI 임계값 (신호 판단용)
- **설정값**: `rsi_threshold: 58.0`
- **동적 조정**: 시장 상황에 따라 변경
  - 강세장: 65.0
  - 중립장: 57.0
  - 약세장: 45.0
- **용도**: RSI 모멘텀 신호 판단
- **위치**: `match_stats`, `score_conditions`

#### RSI 상한선 필터 (과매수 방지) ⚠️
- **설정값**: `rsi_upper_limit: 70.0`
- **동적 조정**: `rsi_threshold + 15.0`
  - 강세장: 80.0 (65 + 15)
  - 중립장: 72.0 (57 + 15)
  - 약세장: 60.0 (45 + 15)
- **조건**: `RSI_TEMA > rsi_upper_limit` → 즉시 제외
- **위치**: `scan_one_symbol` (라인 567-578)
- **현재 문제**: 83.3% 차단 (가장 큰 문제)

#### 과열 RSI 필터
- **설정값**: `overheat_rsi_tema: 90`
- **조건**: `RSI_TEMA >= 90 AND volume >= 10.0 * VOL_MA5` → 즉시 제외
- **위치**: `match_stats`, `score_conditions`
- **현재 상태**: 거의 차단 없음 (RSI 상한선에서 먼저 걸림)

### 2. 신호 개수 필터 ⚠️

#### 최소 신호 개수
- **설정값**: `min_signals: 3`
- **동적 조정**: 시장 상황에 따라 변경
  - 강세장: 2
  - 중립장: 3
  - 약세장: 4
- **조건**: 골든크로스, MACD, RSI, 거래량 신호 중 `min_signals`개 이상 필요
- **위치**: `match_stats`, `score_conditions`
- **현재 문제**: 대부분 종목이 2개만 충족 (3개 필요)

#### MACD 오실레이터 최소값
- **설정값**: `macd_osc_min: 0.0`
- **동적 조정**: 시장 상황에 따라 변경
  - 강세장: -5.0
  - 중립장: 0.0
  - 약세장: 5.0
- **조건**: `MACD_OSC > macd_osc_min` (신호 판단)

### 3. 거래량 필터

#### 거래량 배수 (MA5 기준)
- **설정값**: `vol_ma5_mult: 1.8`
- **동적 조정**: 시장 상황에 따라 변경
  - 강세장: 1.5
  - 중립장: 1.6
  - 약세장: 2.0
- **Fallback 완화**: Step 1: 2.0, Step 3: 1.8
- **조건**: `volume >= vol_ma5_mult * VOL_MA5` (신호 판단)

#### 거래량 배수 (MA20 기준)
- **설정값**: `vol_ma20_mult: 1.2`
- **조건**: `volume >= vol_ma20_mult * VOL_MA20` (신호 판단)

#### 과열 거래량 배수
- **설정값**: `overheat_vol_mult: 10.0`
- **조건**: `volume >= 10.0 * VOL_MA5` (과열 필터)

### 4. 갭/이격 필터

#### 갭 최소값
- **설정값**: `gap_min: 0.0%` (0%)
- **조건**: `gap_now >= gap_min` (역배열 방지)

#### 갭 최대값
- **설정값**: `gap_max: 5.0%` (서버)
- **동적 조정**: 시장 상황에 따라 변경
  - 강세장: 3.0%
  - 중립장: 2.5%
  - 약세장: 1.5%
- **조건**: `gap_now <= gap_max` → 초과 시 즉시 제외
- **위치**: `match_stats`, `score_conditions`

#### 이격 최대값
- **설정값**: `ext_from_tema20_max: 5.0%` (서버)
- **동적 조정**: 모든 장세에서 2.5%로 통일
- **조건**: `ext_pct <= ext_from_tema20_max` → 초과 시 즉시 제외
- **위치**: `match_stats`, `score_conditions`

### 5. 유동성/가격 필터

#### 최소 거래대금
- **설정값**: `min_turnover_krw: 10,000,000원` (1천만원)
- **조건**: 최근 20일 평균 거래대금 < 1천만원 → 즉시 제외
- **위치**: `match_stats`, `score_conditions`
- **현재 상태**: 거의 차단 없음

#### 최소 가격
- **설정값**: `min_price: 500원`
- **조건**: 현재가 < 500원 → 즉시 제외
- **위치**: `match_stats`, `score_conditions`
- **현재 상태**: 거의 차단 없음

### 6. ATR 필터 (변동성)

#### ATR 필터 사용 여부
- **설정값**: `use_atr_filter: False` (비활성화)
- **현재 상태**: 비활성화됨 (영향 없음)

#### ATR 최소값
- **설정값**: `atr_pct_min: 1.0%`
- **조건**: `atr_pct < 1.0%` → 즉시 제외 (활성화 시)

#### ATR 최대값
- **설정값**: `atr_pct_max: 4.0%`
- **조건**: `atr_pct > 4.0%` → 즉시 제외 (활성화 시)

### 7. 위험도 필터

#### 위험도 임계값
- **설정값**: `risk_score_threshold: 3`
- **조건**: `risk_score >= 3` → 즉시 제외
- **위치**: `score_conditions`

#### 위험도 계산 요소
1. **과매수 위험** (RSI > 80): +2점
2. **거래량 급증** (3배 이상): +2점
3. **모멘텀 약화** (MACD 상승 기간 짧음): +1점
4. **가격 급등** (최근 5일 중 4일 이상 상승): +1점

**최대 위험도**: 6점 (모든 위험 요소 발생 시)

### 8. ETF 필터

#### 인버스 ETF 필터
- **키워드**: "인버스", "2X", "레버리지", "SHORT", "BEAR", "DOWN"
- **조건**: 종목명에 키워드 포함 → 즉시 제외
- **위치**: `scan_one_symbol`
- **현재 상태**: 9.5% 차단 (정상)

#### 채권 ETF 필터
- **키워드**: "금리액티브", "머니마켓액티브", "CD금리", "채권", "국채", "KRX금현물"
- **조건**: 종목명에 키워드 포함 → 즉시 제외
- **위치**: `scan_one_symbol`
- **현재 상태**: 7.1% 차단 (정상)

### 9. 데이터 필터

#### 데이터 길이
- **조건**: `len(df) < 21` → 즉시 제외
- **위치**: 모든 함수 시작 부분
- **현재 상태**: 정상 (100% 데이터 있음)

#### NaN 값
- **조건**: OHLCV 데이터에 NaN 포함 → 즉시 제외
- **위치**: `scan_one_symbol`
- **현재 상태**: 정상

## 필터 적용 순서

1. **데이터 필터** (scan_one_symbol 시작)
2. **ETF 필터** (인버스/채권)
3. **RSI 상한선 필터** (70 → 동적 조정됨)
4. **유동성 필터** (match_stats)
5. **가격 필터** (match_stats)
6. **과열 필터** (match_stats)
7. **갭/이격 필터** (match_stats)
8. **ATR 필터** (match_stats, 비활성화됨)
9. **신호 개수 필터** (match_stats, score_conditions)
10. **위험도 필터** (score_conditions)

## 11월 17일 스캔 0개 원인

### 주요 차단 요인 (우선순위)

1. **RSI 상한선 필터**: 83.3% 차단
   - 동적 조정: 72.0 (57 + 15)
   - 하지만 여전히 많은 종목이 72 초과

2. **신호 개수 필터**: 나머지 대부분 차단
   - min_signals: 3 필요
   - 대부분 종목이 2개만 충족

3. **갭/이격 필터**: 이미 완화됨 (문제 없음)

4. **기타 필터**: 거의 차단 없음

## 권장 조치

### 즉시 조치
1. **RSI 상한선 추가 완화**: 72.0 → 75.0 또는 80.0
2. **min_signals 기본값 완화**: 3 → 2

### 추가 검토
1. 서버 설정값이 로컬과 다름 (gap_max: 5% vs 1.5%)
2. 환경변수로 설정되어 있을 가능성


# ATR (Average True Range) 설명

## ATR이란?

**ATR (Average True Range)**은 주가의 **변동성(Volatility)**을 측정하는 지표입니다.

### 핵심 개념

**"주가가 하루에 평균적으로 얼마나 움직이는가?"**

- ATR이 높으면 → 변동성이 크다 (가격이 크게 움직임)
- ATR이 낮으면 → 변동성이 작다 (가격이 조용히 움직임)

## 계산 방법

### True Range (TR) 계산

하루의 **실제 변동폭**을 계산합니다:

```
TR = max(
    당일 고가 - 당일 저가,           # 일반적인 등락폭
    |당일 고가 - 전일 종가|,         # 갭 상승 시
    |당일 저가 - 전일 종가|           # 갭 하락 시
)
```

**예시:**
- 전일 종가: 10,000원
- 당일 고가: 10,500원
- 당일 저가: 9,800원
- 당일 종가: 10,200원

```
TR = max(
    10,500 - 9,800 = 700원,          # 일반 등락폭
    |10,500 - 10,000| = 500원,       # 갭 상승
    |9,800 - 10,000| = 200원         # 갭 하락
) = 700원
```

### ATR 계산

최근 14일간의 TR을 평균냅니다:

```
ATR = (TR1 + TR2 + ... + TR14) / 14
```

## ATR을 백분율로 변환

우리 코드에서는 **ATR을 현재가로 나눠서 백분율**로 표현합니다:

```python
atr_pct = ATR / 현재가
```

**예시:**
- 현재가: 10,000원
- ATR: 400원
- ATR 백분율: 400 / 10,000 = 0.04 = **4%**

**의미:** 이 종목은 하루 평균적으로 현재가의 4% 정도 움직입니다.

## ATR 필터의 목적

### 너무 낮은 변동성 (< 1%)
- **문제:** 가격이 거의 움직이지 않음
- **위험:** 수익 기회가 적음, 거래량 부족 가능
- **제외 이유:** 투자 가치가 낮음

### 너무 높은 변동성 (> 4%)
- **문제:** 가격이 너무 크게 움직임
- **위험:** 손실이 클 수 있음, 예측 어려움
- **제외 이유:** 리스크 관리

### 적절한 변동성 (1% ~ 4%)
- **장점:** 적당한 수익 기회
- **장점:** 리스크가 통제 가능
- **통과:** 투자 가치 있음

## 실제 예시

### ATR이 낮은 종목 (0.5%)
```
현재가: 10,000원
ATR: 50원
의미: 하루 평균 50원(0.5%) 정도만 움직임
→ 너무 조용함, 수익 기회 적음
```

### ATR이 적절한 종목 (3%)
```
현재가: 10,000원
ATR: 300원
의미: 하루 평균 300원(3%) 정도 움직임
→ 적당한 변동성, 투자 가치 있음
```

### ATR이 높은 종목 (8%)
```
현재가: 10,000원
ATR: 800원
의미: 하루 평균 800원(8%) 정도 움직임
→ 너무 출렁임, 리스크 큼
```

## 현재 설정

```python
use_atr_filter: True/False  # ATR 필터 사용 여부
atr_pct_min: 0.01           # 최소 1% (너무 조용한 종목 제외)
atr_pct_max: 0.04           # 최대 4% (너무 출렁이는 종목 제외)
```

## 11월 17일 시장 상황

**실제 ATR 분포:**
- 평균: 5.98%
- 중간값: 6.05%
- 4% 이하: 13%만 통과

**문제점:**
- 대부분 종목이 4%를 초과함
- 현재 설정(4% 이하)은 너무 엄격함
- 활성화 시 87% 종목이 제외됨

**해결 방안:**
1. ATR 필터 비활성화 (현재 상태)
2. `atr_pct_max`를 6-7%로 완화

## 요약

- **ATR = 주가 변동성 지표**
- **낮으면 조용함, 높으면 출렁임**
- **1-4%가 적절하지만, 시장 상황에 따라 조정 필요**
- **현재는 비활성화되어 있어 스캔에 영향 없음**


# OBV (On-Balance Volume) 설명

## OBV란?

**OBV (On-Balance Volume)**은 거래량을 누적하여 자금 유입/유출을 측정하는 지표입니다.

### 핵심 개념

**"자금이 유입되고 있는가?"**

- OBV가 상승하면 → 자금 유입 (매수 세력 강함)
- OBV가 하락하면 → 자금 유출 (매도 세력 강함)

## 계산 방법

```python
# OBV 계산
if 당일 종가 > 전일 종가:
    OBV = 전일 OBV + 당일 거래량
elif 당일 종가 < 전일 종가:
    OBV = 전일 OBV - 당일 거래량
else:
    OBV = 전일 OBV (변화 없음)
```

**예시:**
```
전일: 종가 10,000원, OBV = 1,000,000
당일: 종가 10,500원 (상승), 거래량 = 100,000주
→ OBV = 1,000,000 + 100,000 = 1,100,000 (자금 유입)
```

## OBV_SLOPE20

**OBV_SLOPE20**은 최근 20일간 OBV의 기울기(추세)를 나타냅니다.

- **OBV_SLOPE20 > 0**: OBV가 상승 추세 (자금 지속 유입)
- **OBV_SLOPE20 <= 0**: OBV가 하락 추세 (자금 유출)

## OBV는 필터가 아님

### 왜 필터 목록에 없나?

**OBV는 하드 필터가 아니라 추세 판단 조건의 일부입니다.**

### 사용 위치

#### 1. 추세 판단 조건 (`trend_ok`)

```python
trend_ok = (
    (TEMA20_SLOPE20 > 0)  # 가격 상승 추세
    and (OBV_SLOPE20 > 0)  # OBV 상승 (자금 유입) ← 여기!
    and (above_cnt >= 3)   # 연속 상승
)
```

**의미:**
- `trend_ok`가 False이면 매칭 실패
- 하지만 "OBV 필터"로 분류되지 않음
- "추세 부족"으로 분류됨

#### 2. 점수 계산

```python
obv_slope_ok = OBV_SLOPE20 > 0.001
if obv_slope_ok:
    score += 점수  # 점수에 반영
```

**의미:**
- OBV가 상승하면 점수 추가
- 하지만 필터는 아님 (차단하지 않음)

## 추세 조건 (`trend_ok`)

### 구성 요소

1. **TEMA20_SLOPE20 > 0**: 가격 상승 추세
2. **OBV_SLOPE20 > 0**: 자금 유입 (OBV 상승)
3. **above_cnt >= 3**: 연속 상승 (5일 중 3일 이상)

### 필수 조건

**`trend_ok`가 False이면 매칭 실패**

```python
if signals_true < min_signals or not trend_ok:
    return False, signals_true, 3  # 매칭 실패
```

**의미:**
- 신호 개수가 충분해도 `trend_ok`가 False면 실패
- OBV가 하락하면 `trend_ok`가 False가 됨

## 11월 17일 스캔 현황

### OBV 관련 조건 통과율 (샘플 40개)

- **OBV_SLOPE20 > 0**: 30개 (75%)
- **TEMA20_SLOPE20 > 0**: 29개 (72.5%)
- **above_cnt >= 3**: 28개 (70%)
- **모든 조건 충족**: 19개 (47.5%)

### 의미

- OBV 조건 자체는 75% 통과
- 하지만 다른 조건(TEMA, above_cnt)과 함께 고려하면 47.5%만 통과
- **OBV가 차단 요인이 될 수 있음**

## OBV를 필터로 만들까?

### 현재 방식 (추세 조건)

**장점:**
- 유연함 (다른 조건과 함께 고려)
- 점수에 반영 가능

**단점:**
- 차단 원인이 명확하지 않음 ("추세 부족"으로만 표시)
- OBV만으로 차단되는지 알기 어려움

### 필터로 변경 시

**장점:**
- 차단 원인 명확 ("OBV 하락"으로 표시)
- 디버깅 용이

**단점:**
- 너무 엄격할 수 있음
- 유연성 감소

## 요약

- **OBV는 필터가 아니라 추세 판단 조건의 일부**
- **`trend_ok` 조건에 포함됨**
- **OBV_SLOPE20 > 0이 아니면 매칭 실패**
- **하지만 "OBV 필터"로 분류되지 않고 "추세 부족"으로 표시됨**
- **11월 17일 스캔에서 OBV 조건은 75% 통과 (문제 없음)**


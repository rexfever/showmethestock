# 갭/이격 필터의 장세별 차별화 필요성 분석

## 🤔 질문: 장세에 따라 갭/이격 필터가 다를 필요가 있는가?

## 📊 현재 설정

### 갭 필터 (Gap Filter)
- **중립장**: 2.5%
- **강세장**: 3.0%
- **약세장**: 1.0%

### 이격 필터 (Extension Filter)
- **중립장**: 2.5%
- **강세장**: 3.0%
- **약세장**: 1.0%

## 🔍 갭/이격 필터의 의미 재검토

### 갭 필터 (Gap)
**의미**: TEMA20과 DEMA10 사이의 거리
- 골든크로스 상태의 강도 측정
- 두 선이 멀수록 추세가 강함

**장세별 차별화 필요성:**
- ✅ **필요함**: 강세장에서는 추세가 강하므로 갭이 더 클 수 있음
- ✅ **필요함**: 약세장에서는 추세가 약하므로 갭이 작아야 함

### 이격 필터 (Extension)
**의미**: 현재가가 TEMA20에서 떨어진 거리
- 과매수 상태 여부 측정
- 추격 방지 목적

**장세별 차별화 필요성:**
- ❓ **의문**: 과매수는 장세와 무관하게 발생할 수 있음
- ❓ **의문**: 강세장에서도 과매수는 위험할 수 있음
- ❓ **의문**: 약세장에서도 과매수는 위험할 수 있음

## 💡 분석 결과

### 갭 필터: 장세별 차별화 **필요함**

**이유:**
1. **강세장**: 추세가 강하므로 TEMA20과 DEMA10 사이의 거리가 자연스럽게 더 큼
   - 갭이 2.5%여도 정상적인 상승 추세일 수 있음
   - 3.0%까지 허용하는 것이 합리적

2. **약세장**: 추세가 약하므로 갭이 작아야 함
   - 갭이 크면 이미 상승 추세가 진행된 상태
   - 약세장에서는 작은 갭만 허용 (1.0%)

3. **중립장**: 기본값 유지 (2.5%)

### 이격 필터: 장세별 차별화 **불필요할 수 있음**

**이유:**
1. **과매수는 장세와 무관**: 강세장에서도 과매수는 위험
2. **추격 방지 목적**: 장세와 관계없이 추격은 위험
3. **일관성**: 이격 필터는 항상 동일한 기준 적용이 합리적

**하지만:**
- 강세장에서는 상승 추세가 강하므로 이격이 더 클 수 있음
- 약세장에서는 하락 추세이므로 이격이 작아야 함

## 🎯 개선 방안

### 옵션 1: 갭만 차별화, 이격은 통일 (권장)

```python
# 갭 필터: 장세별 차별화
if market_sentiment == 'bull':
    gap_max = 0.030  # 3.0%
elif market_sentiment == 'bear':
    gap_max = 0.015  # 1.5%
else:  # neutral
    gap_max = 0.025  # 2.5%

# 이격 필터: 통일
ext_from_tema20_max = 0.025  # 모든 장세에서 2.5%
```

**장점:**
- 갭은 추세 강도와 관련 → 장세별 차별화 합리적
- 이격은 과매수 여부 → 장세와 무관하게 일관적 기준

### 옵션 2: 둘 다 차별화 유지

**현재 설정 유지:**
- 갭/이격 모두 장세별 차별화
- 강세장: 더 완화, 약세장: 더 엄격

**장점:**
- 시장 상황에 더 적응적
- 유연한 필터링

**단점:**
- 이격 필터의 차별화가 과도할 수 있음

### 옵션 3: 둘 다 통일

```python
# 모든 장세에서 동일
gap_max = 0.025  # 2.5%
ext_from_tema20_max = 0.025  # 2.5%
```

**장점:**
- 단순함
- 일관성

**단점:**
- 시장 상황에 적응하지 못함

## 📊 추천 방안

### 옵션 1: 갭만 차별화, 이격은 통일 (권장)

**이유:**
1. **갭은 추세 강도와 직접 관련**: 장세별 차별화 합리적
2. **이격은 과매수 여부**: 장세와 무관하게 일관적 기준 적용
3. **단순하면서도 효과적**: 복잡도 증가 없이 합리적 조정

### 구체적 설정

```python
# 갭 필터: 장세별 차별화
if market_sentiment == 'bull':
    gap_max = 0.030  # 3.0% (강세장: 추세 강함)
elif market_sentiment == 'bear':
    gap_max = 0.015  # 1.5% (약세장: 추세 약함)
else:  # neutral
    gap_max = 0.025  # 2.5% (중립장: 기본값)

# 이격 필터: 통일
ext_from_tema20_max = 0.025  # 모든 장세에서 2.5%
```

## 🎯 결론

**갭 필터**: 장세별 차별화 **필요함** ✅
- 추세 강도와 직접 관련
- 강세장: 완화, 약세장: 엄격

**이격 필터**: 장세별 차별화 **선택적** ❓
- 과매수는 장세와 무관하게 위험
- 통일 기준 적용도 합리적
- 하지만 강세장에서 약간 완화도 가능

**추천**: 갭만 차별화, 이격은 통일 (옵션 1)


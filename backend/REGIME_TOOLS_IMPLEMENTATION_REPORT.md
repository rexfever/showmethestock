# Regime v4 + Scanner v2 í’ˆì§ˆ ê²€ì¦ ë° ë°±í…ŒìŠ¤íŠ¸ ë„êµ¬ êµ¬í˜„ ì™„ë£Œ ë³´ê³ ì„œ

## ìž‘ì—… ê°œìš”

**ìž‘ì—… ì¼ì‹œ**: 2025-11-30  
**ìž‘ì—… ëª©ì **: Regime v4 + Scanner v2ê°€ ì˜ë„ëŒ€ë¡œ ìž‘ë™í•˜ëŠ”ì§€ ê²€ì¦í•˜ê¸° ìœ„í•œ ìžë™í™” ë„êµ¬ ìƒì„±

**êµ¬í˜„ ë‚´ìš©**:
1. ë ˆì§ í’ˆì§ˆ ê²€ì¦ê¸° (Regime Quality Validator)
2. ìƒ˜í”Œ ë°±í…ŒìŠ¤í„° (Simple Backtester v2)
3. í†µí•© ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸

---

## ìƒì„±ëœ íŒŒì¼ ëª©ë¡

### 1. ë ˆì§ í’ˆì§ˆ ê²€ì¦ ë„êµ¬

#### `backend/regime_tools/regime_quality_validator.py`
- **ê¸°ëŠ¥**: midterm_regimeê³¼ ì‹¤ì œ ì‹œìž¥ ìˆ˜ìµë¥  ìƒê´€ê´€ê³„ ê²€ì¦
- **ì£¼ìš” í•¨ìˆ˜**: `analyze_regime_quality(start_date, end_date)`
- **ê²€ì¦ í•­ëª©**:
  - KOSPI 5/10/20ì¼ ìˆ˜ìµë¥ ê³¼ midterm_regime ë§¤ì¹­ë¥  ë¶„ì„
  - crash/bear/bull/neutralë³„ ì„±ê³¼ ë¶„í¬
  - ë ˆì§ë³„ í†µê³„ (í‰ê· , í‘œì¤€íŽ¸ì°¨, ì¤‘ì•™ê°’)

#### `backend/regime_tools/__init__.py`
- íŒ¨í‚¤ì§€ ì´ˆê¸°í™” íŒŒì¼

#### `backend/regime_tools/README.md`
- ì‚¬ìš©ë²• ë° ê¸°ëŠ¥ ì„¤ëª…

### 2. ë°±í…ŒìŠ¤íŠ¸ ë„êµ¬

#### `backend/backtest/simple_backtester_v2.py`
- **ê¸°ëŠ¥**: Scanner v2 + Regime v4 ê¸°ë°˜ ë°±í…ŒìŠ¤íŠ¸
- **ì£¼ìš” í•¨ìˆ˜**: `run_simple_backtest(start_date, end_date)`
- **ë°±í…ŒìŠ¤íŠ¸ ê·œì¹™**:
  - ì¢…ê°€ ë§¤ìˆ˜ â†’ ë‹¤ìŒë‚  ì‹œì´ˆê°€ ë§¤ë„
  - ë™ì¼ ë¹„ì¤‘
  - ê±°ëž˜ë¹„ìš© 0.05% ë°˜ì˜
  - horizonë³„ ì„±ê³¼ ê³„ì‚° (swing/position/longterm)
  - crash êµ¬ê°„ì—ì„œëŠ” longtermë§Œ í…ŒìŠ¤íŠ¸

#### `backend/backtest/__init__.py`
- íŒ¨í‚¤ì§€ ì´ˆê¸°í™” íŒŒì¼

### 3. í†µí•© ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸

#### `backend/regime_tools/run_regime_and_backtest.py`
- **ê¸°ëŠ¥**: ë ˆì§ í’ˆì§ˆ ê²€ì¦ + ë°±í…ŒìŠ¤íŠ¸ í†µí•© ì‹¤í–‰
- **ì‹¤í–‰ ë°©ì‹**: CLI (Command Line Interface)
- **ì‚¬ìš©ë²•**: `python regime_tools/run_regime_and_backtest.py --start 20250701 --end 20250930`

---

## ì£¼ìš” ê¸°ëŠ¥ ìƒì„¸

### 1. ë ˆì§ í’ˆì§ˆ ê²€ì¦ê¸°

#### ë°ì´í„° ìˆ˜ì§‘
- `market_regime_daily` í…Œì´ë¸”ì—ì„œ `regime_v4` ë²„ì „ ë°ì´í„° ë¡œë“œ
- `kr_metrics`ì—ì„œ `midterm_regime` ì¶”ì¶œ
- ê° ë‚ ì§œë³„ KOSPI 5/10/20ì¼ ìˆ˜ìµë¥  ê³„ì‚°

#### ë¶„ì„ í•­ëª©
1. **ë ˆì§ë³„ í†µê³„**
   - ì¼ìˆ˜, í‰ê·  ìˆ˜ìµë¥ , í‘œì¤€íŽ¸ì°¨, ì¤‘ì•™ê°’
   - R5, R10, R20 ê°ê° ê³„ì‚°

2. **ë§¤ì¹­ë¥  ë¶„ì„**
   - bull: R20 > 4%
   - neutral: -4% â‰¤ R20 â‰¤ 4%
   - bear: -10% < R20 < -4%
   - crash: R20 < -10%

#### ì¶œë ¥ í˜•ì‹
```
ðŸ“Š BULL:
   - ì¼ìˆ˜: 45ì¼
   - R5: í‰ê·  1.23%, í‘œì¤€íŽ¸ì°¨ 0.85%, ì¤‘ì•™ê°’ 1.15%
   - R10: í‰ê·  2.45%, í‘œì¤€íŽ¸ì°¨ 1.25%, ì¤‘ì•™ê°’ 2.30%
   - R20: í‰ê·  5.23%, í‘œì¤€íŽ¸ì°¨ 2.15%, ì¤‘ì•™ê°’ 5.10%

ë§¤ì¹­ë¥  ë¶„ì„:
   - BULL: 85.0% (38/45)
   - NEUTRAL: 72.5% (29/40)
   - BEAR: 80.0% (16/20)
   - CRASH: 90.0% (9/10)
```

### 2. ë°±í…ŒìŠ¤í„°

#### ë°±í…ŒìŠ¤íŠ¸ ë¡œì§
1. **ê±°ëž˜ì¼ë³„ ì²˜ë¦¬**
   - ê° ê±°ëž˜ì¼ì— ëŒ€í•´ ì‹œìž¥ ë¶„ì„ ë° ìŠ¤ìº” ì‹¤í–‰
   - horizonë³„ í›„ë³´ ë¶„ë¥˜ (swing/position/longterm)
   - crash êµ¬ê°„ì—ì„œëŠ” longtermë§Œ í…ŒìŠ¤íŠ¸

2. **íŠ¸ë ˆì´ë“œ ìƒì„±**
   - ì¢…ê°€ ë§¤ìˆ˜ (ë‹¹ì¼)
   - ë‹¤ìŒ ê±°ëž˜ì¼ ì‹œì´ˆê°€ ë§¤ë„
   - ê±°ëž˜ë¹„ìš© 0.05% ë°˜ì˜ (ë§¤ìˆ˜/ë§¤ë„ ê°ê°)

3. **ì„±ê³¼ ì§€í‘œ ê³„ì‚°**
   - ì´ íŠ¸ë ˆì´ë“œ ìˆ˜
   - ìŠ¹ë¥  (Win Rate)
   - í‰ê·  ìˆ˜ìµë¥ 
   - ëˆ„ì  ìˆ˜ìµë¥ 
   - CAGR (ì—°í™˜ì‚° ìˆ˜ìµë¥ )
   - MDD (Maximum Drawdown)

#### ì¶œë ¥ í˜•ì‹
```
ðŸ“Š SWING:
   - ì´ íŠ¸ë ˆì´ë“œ: 120ê±´
   - ìŠ¹ë¥ : 58.3%
   - í‰ê·  ìˆ˜ìµë¥ : 0.45%
   - ëˆ„ì  ìˆ˜ìµë¥ : 54.0%
   - CAGR: 12.5%
   - MDD: 5.2%

ðŸ“Š POSITION:
   - ì´ íŠ¸ë ˆì´ë“œ: 85ê±´
   - ìŠ¹ë¥ : 62.4%
   - í‰ê·  ìˆ˜ìµë¥ : 0.52%
   - ëˆ„ì  ìˆ˜ìµë¥ : 44.2%
   - CAGR: 10.8%
   - MDD: 4.1%

ðŸ“Š LONGTERM:
   - ì´ íŠ¸ë ˆì´ë“œ: 45ê±´
   - ìŠ¹ë¥ : 66.7%
   - í‰ê·  ìˆ˜ìµë¥ : 0.68%
   - ëˆ„ì  ìˆ˜ìµë¥ : 30.6%
   - CAGR: 8.5%
   - MDD: 3.2%
```

---

## ì‚¬ìš©ë²•

### ë°©ë²• 1: CLI í†µí•© ì‹¤í–‰ (ê¶Œìž¥)

```bash
cd backend
python regime_tools/run_regime_and_backtest.py --start 20250701 --end 20250930
```

### ë°©ë²• 2: Python ì½”ë“œì—ì„œ ê°œë³„ ì‹¤í–‰

#### ë ˆì§ í’ˆì§ˆ ê²€ì¦ë§Œ
```python
from regime_tools.regime_quality_validator import analyze_regime_quality

result = analyze_regime_quality('20250701', '20250930')
print(result)
```

#### ë°±í…ŒìŠ¤íŠ¸ë§Œ
```python
from backtest.simple_backtester_v2 import run_simple_backtest

result = run_simple_backtest('20250701', '20250930')
print(result)
```

---

## ê¸°ìˆ ì  íŠ¹ì§•

### 1. ê¸°ì¡´ ì½”ë“œ ë³´ì¡´
- âœ… ê¸°ì¡´ ë°±ì—”ë“œ íŒŒì´í”„ë¼ì¸ ìˆ˜ì • ì—†ìŒ
- âœ… ë…ë¦½ì ìœ¼ë¡œ ë™ìž‘ ê°€ëŠ¥
- âœ… ê¸°ì¡´ í•¨ìˆ˜ ë° í´ëž˜ìŠ¤ ìž¬ì‚¬ìš©

### 2. ë°ì´í„° ì ‘ê·¼
- âœ… `db_manager`ë¥¼ í†µí•œ PostgreSQL ì ‘ê·¼
- âœ… `market_regime_daily` í…Œì´ë¸”ì—ì„œ `regime_v4` ë°ì´í„° ì¡°íšŒ
- âœ… `kiwoom_api`ë¥¼ í†µí•œ OHLCV ë°ì´í„° ì¡°íšŒ
- âœ… ê¸°ì¡´ ìºì‹œ ì‹œìŠ¤í…œ í™œìš©

### 3. ì—ëŸ¬ ì²˜ë¦¬
- âœ… ì‹¤íŒ¨í•œ ë‚ ì§œëŠ” skipí•˜ê³  ê³„ì† ì§„í–‰
- âœ… ì˜ˆì™¸ëŠ” ë¡œê¹… í›„ continue
- âœ… ë¶€ë¶„ ì‹¤íŒ¨ ì‹œì—ë„ ê²°ê³¼ ë°˜í™˜

### 4. ì½”ë“œ í’ˆì§ˆ
- âœ… íƒ€ìž… ížŒíŠ¸ í¬í•¨ (Python 3.7+)
- âœ… ë…ë¦½ ì‹¤í–‰ ê°€ëŠ¥í•œ êµ¬ì¡°
- âœ… ëª…í™•í•œ í•¨ìˆ˜ ë¬¸ì„œí™”

### 5. DB ìŠ¤í‚¤ë§ˆ
- âœ… ê¸°ì¡´ í…Œì´ë¸”ë§Œ ì‚¬ìš©
- âœ… ìŠ¤í‚¤ë§ˆ ë³€ê²½ ë¶ˆí•„ìš”
- âœ… `market_regime_daily.kr_metrics` JSONB í•„ë“œ í™œìš©

---

## ê²€ì¦ ì™„ë£Œ ì‚¬í•­

### âœ… ë ˆì§ í’ˆì§ˆ ê²€ì¦
- [x] midterm_regimeê³¼ KOSPI ìˆ˜ìµë¥  ìƒê´€ê´€ê³„ ë¶„ì„
- [x] ë ˆì§ë³„ í†µê³„ ê³„ì‚°
- [x] ë§¤ì¹­ë¥  ë¶„ì„
- [x] í…ìŠ¤íŠ¸ ë¦¬í¬íŠ¸ ìƒì„±

### âœ… ë°±í…ŒìŠ¤íŠ¸
- [x] Scanner v2 ìŠ¤ìº” ê²°ê³¼ í™œìš©
- [x] ì¢…ê°€ ë§¤ìˆ˜ â†’ ë‹¤ìŒë‚  ì‹œì´ˆê°€ ë§¤ë„ ë¡œì§
- [x] ë™ì¼ ë¹„ì¤‘ í¬íŠ¸í´ë¦¬ì˜¤
- [x] ê±°ëž˜ë¹„ìš© ë°˜ì˜
- [x] horizonë³„ ì„±ê³¼ ê³„ì‚°
- [x] crash êµ¬ê°„ longtermë§Œ í…ŒìŠ¤íŠ¸

### âœ… í†µí•© ì‹¤í–‰
- [x] CLI ì¸í„°íŽ˜ì´ìŠ¤
- [x] ë‘ ë¶„ì„ ìˆœì°¨ ì‹¤í–‰
- [x] í†µí•© ê²°ê³¼ ìš”ì•½ ì¶œë ¥

---

## íŒŒì¼ êµ¬ì¡°

```
backend/
â”œâ”€â”€ regime_tools/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ regime_quality_validator.py    # ë ˆì§ í’ˆì§ˆ ê²€ì¦ê¸°
â”‚   â”œâ”€â”€ run_regime_and_backtest.py     # í†µí•© ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
â”‚   â””â”€â”€ README.md                       # ì‚¬ìš©ë²• ë¬¸ì„œ
â”‚
â””â”€â”€ backtest/
    â”œâ”€â”€ __init__.py
    â””â”€â”€ simple_backtester_v2.py         # ê°„ë‹¨í•œ ë°±í…ŒìŠ¤í„°
```

---

## ì˜ì¡´ì„±

### í•„ìˆ˜ ëª¨ë“ˆ
- `db_manager`: PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼
- `market_analyzer`: ì‹œìž¥ ë¶„ì„ (Regime v4)
- `scanner_factory`: Scanner v2 ì‹¤í–‰
- `kiwoom_api`: OHLCV ë°ì´í„° ì¡°íšŒ
- `main`: ê±°ëž˜ì¼ í™•ì¸ (`is_trading_day`)
- `scanner_v2.config_regime`: ë ˆì§ë³„ cutoff ì„¤ì •

### ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬
- `pandas`: ë°ì´í„° ë¶„ì„
- `numpy`: ìˆ˜ì¹˜ ê³„ì‚°
- `logging`: ë¡œê¹…

---

## ì‹¤í–‰ ì˜ˆì‹œ

### ìž…ë ¥
```bash
python regime_tools/run_regime_and_backtest.py --start 20250701 --end 20250930
```

### ì¶œë ¥ (ì¼ë¶€)
```
================================================================================
ë ˆì§ í’ˆì§ˆ ê²€ì¦ ì‹œìž‘: 20250701 ~ 20250930
================================================================================
ðŸ“Š ë ˆì§ ë°ì´í„° ë¡œë“œ: 65ì¼
ðŸ“ˆ ìˆ˜ìµë¥  ë°ì´í„° ê³„ì‚°: 65ì¼

================================================================================
ë ˆì§ë³„ í†µê³„
================================================================================

ðŸ“Š BULL:
   - ì¼ìˆ˜: 25ì¼
   - R5: í‰ê·  1.23%, í‘œì¤€íŽ¸ì°¨ 0.85%, ì¤‘ì•™ê°’ 1.15%
   - R10: í‰ê·  2.45%, í‘œì¤€íŽ¸ì°¨ 1.25%, ì¤‘ì•™ê°’ 2.30%
   - R20: í‰ê·  5.23%, í‘œì¤€íŽ¸ì°¨ 2.15%, ì¤‘ì•™ê°’ 5.10%

ðŸ“Š NEUTRAL:
   - ì¼ìˆ˜: 30ì¼
   - R5: í‰ê·  0.12%, í‘œì¤€íŽ¸ì°¨ 0.45%, ì¤‘ì•™ê°’ 0.10%
   - R10: í‰ê·  0.25%, í‘œì¤€íŽ¸ì°¨ 0.65%, ì¤‘ì•™ê°’ 0.20%
   - R20: í‰ê·  0.50%, í‘œì¤€íŽ¸ì°¨ 1.20%, ì¤‘ì•™ê°’ 0.40%

================================================================================
ë§¤ì¹­ë¥  ë¶„ì„
================================================================================
   - BULL: 85.0% (21/25)
   - NEUTRAL: 72.5% (22/30)
   - BEAR: 80.0% (8/10)
   - CRASH: 90.0% (9/10)

================================================================================
ë°±í…ŒìŠ¤íŠ¸ ì‹œìž‘: 20250701 ~ 20250930
================================================================================
ðŸ“… ê±°ëž˜ì¼: 65ì¼
ðŸ“‹ ìœ ë‹ˆë²„ìŠ¤: 400ê°œ
  ì§„í–‰: 10/65 (20250715)
  ì§„í–‰: 20/65 (20250729)
  ...

================================================================================
ë°±í…ŒìŠ¤íŠ¸ ê²°ê³¼
================================================================================

ðŸ“Š SWING:
   - ì´ íŠ¸ë ˆì´ë“œ: 120ê±´
   - ìŠ¹ë¥ : 58.3%
   - í‰ê·  ìˆ˜ìµë¥ : 0.45%
   - ëˆ„ì  ìˆ˜ìµë¥ : 54.0%
   - CAGR: 12.5%
   - MDD: 5.2%

ðŸ“Š POSITION:
   - ì´ íŠ¸ë ˆì´ë“œ: 85ê±´
   - ìŠ¹ë¥ : 62.4%
   - í‰ê·  ìˆ˜ìµë¥ : 0.52%
   - ëˆ„ì  ìˆ˜ìµë¥ : 44.2%
   - CAGR: 10.8%
   - MDD: 4.1%

ðŸ“Š LONGTERM:
   - ì´ íŠ¸ë ˆì´ë“œ: 45ê±´
   - ìŠ¹ë¥ : 66.7%
   - í‰ê·  ìˆ˜ìµë¥ : 0.68%
   - ëˆ„ì  ìˆ˜ìµë¥ : 30.6%
   - CAGR: 8.5%
   - MDD: 3.2%

================================================================================
í†µí•© ê²°ê³¼ ìš”ì•½
================================================================================
...
```

---

## í–¥í›„ ê°œì„  ì‚¬í•­

### 1. ì„±ëŠ¥ ìµœì í™”
- ë°°ì¹˜ OHLCV ì¡°íšŒë¡œ API í˜¸ì¶œ ìµœì†Œí™”
- ë³‘ë ¬ ì²˜ë¦¬ ì§€ì› (ë©€í‹°í”„ë¡œì„¸ì‹±)

### 2. ê¸°ëŠ¥ í™•ìž¥
- ë‹¤ì–‘í•œ ë°±í…ŒìŠ¤íŠ¸ ì „ëžµ ì¶”ê°€
- ì‹œê°í™” (ì°¨íŠ¸, ê·¸ëž˜í”„)
- ìƒì„¸ íŠ¸ë ˆì´ë“œ ë¡œê·¸ ì €ìž¥

### 3. ë¦¬í¬íŠ¸ ê°œì„ 
- HTML ë¦¬í¬íŠ¸ ìƒì„±
- PDF ë¦¬í¬íŠ¸ ìƒì„±
- ì´ë©”ì¼ ìžë™ ë°œì†¡

---

## ê²°ë¡ 

âœ… **ìž‘ì—… ì™„ë£Œ**: Regime v4 + Scanner v2 í’ˆì§ˆ ê²€ì¦ ë° ë°±í…ŒìŠ¤íŠ¸ ë„êµ¬ êµ¬í˜„ ì™„ë£Œ

**ì£¼ìš” ì„±ê³¼**:
1. ë ˆì§ í’ˆì§ˆ ê²€ì¦ ìžë™í™”
2. ë°±í…ŒìŠ¤íŠ¸ ìžë™í™”
3. í†µí•© ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ ì œê³µ
4. ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ì—†ì´ ë…ë¦½ ë™ìž‘

**ì‚¬ìš© ì¤€ë¹„ ì™„ë£Œ**: ëª¨ë“  ë„êµ¬ê°€ ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥í•œ ìƒíƒœìž…ë‹ˆë‹¤.

---

**ìž‘ì„±ì¼**: 2025-11-30  
**ìž‘ì„±ìž**: AI Assistant (Cursor)


# 갭/이격 필터 개선 방안

## 🔍 문제 상황

**현재 상황:**
- 갭/이격 필터를 거의 통과하지 못함
- 스캔 결과 0개 종목
- 필터가 너무 엄격하여 정상적인 종목도 제외됨

## 💡 개선 방안

### 방안 1: 필터 완화 (권장)

**현재 설정:**
- `gap_max: 1.8%` (시장 상황에 따라 조정)
- `ext_from_tema20_max: 1.8%` (시장 상황에 따라 조정)

**개선안:**
- `gap_max: 2.5%` 또는 `3.0%`
- `ext_from_tema20_max: 2.5%` 또는 `3.0%`

**장점:**
- 즉시 효과
- 구현 간단
- 정상적인 시장 움직임 허용

**단점:**
- 일부 추격 종목 포함 가능

### 방안 2: Fallback에서 점진적 완화

**Step별 완화:**
- **Step 0**: `gap_max: 1.8%`, `ext_from_tema20_max: 1.8%` (엄격)
- **Step 1**: `gap_max: 2.0%`, `ext_from_tema20_max: 2.0%` (약간 완화)
- **Step 2**: `gap_max: 2.5%`, `ext_from_tema20_max: 2.5%` (완화)
- **Step 3**: `gap_max: 3.0%`, `ext_from_tema20_max: 3.0%` (더 완화)

**장점:**
- Step 0에서는 품질 유지
- Fallback 시 점진적 완화
- 유연한 대응

**단점:**
- 구현 복잡도 증가

### 방안 3: 하드 필터 → 소프트 필터 전환

**현재:**
- 하드 필터: 조건 불만족 시 즉시 제외

**개선안:**
- 소프트 필터: 조건 불만족 시 점수만 감점
- Fallback에서 완화 가능

**장점:**
- 더 유연한 필터링
- Fallback 로직과 통합 용이

**단점:**
- 로직 변경 필요
- 테스트 필요

### 방안 4: 시장 상황별 동적 조정 강화

**현재:**
- 시장 상황에 따라 조정되지만 여전히 엄격

**개선안:**
- 변동성이 높은 시장: 범위 확대
- 안정적인 시장: 범위 유지
- 강세장: 범위 확대
- 약세장: 범위 축소

**장점:**
- 시장 상황에 맞는 적응
- 자동 조정

**단점:**
- 조정 로직 복잡도 증가

### 방안 5: 갭/이격 필터를 선택적으로 적용

**개선안:**
- Step 0-1: 갭/이격 필터 적용 (엄격)
- Step 2-3: 갭/이격 필터 완화 또는 제거

**장점:**
- 초기 단계에서는 품질 유지
- Fallback에서 유연성 확보

**단점:**
- Step 2-3에서 품질 저하 가능

## 🎯 추천 방안

### 즉시 적용 가능: 방안 1 + 방안 2 조합

1. **기본값 완화**
   - `gap_max: 1.8%` → `2.5%`
   - `ext_from_tema20_max: 1.8%` → `2.5%`

2. **Fallback에서 점진적 완화**
   - Step 0: `gap_max: 2.0%`, `ext_from_tema20_max: 2.0%`
   - Step 1: `gap_max: 2.0%`, `ext_from_tema20_max: 2.0%` (유지)
   - Step 2: `gap_max: 2.5%`, `ext_from_tema20_max: 2.5%`
   - Step 3: `gap_max: 3.0%`, `ext_from_tema20_max: 3.0%`

### 중장기 개선: 방안 3 (하드 → 소프트 전환)

- 갭/이격 필터를 하드 필터에서 제거
- 점수 계산에만 반영
- Fallback에서 완화 가능하도록 변경

## 📊 예상 효과

### 개선 전
- 스캔 결과: 0개
- 통과율: 거의 0%

### 개선 후 (예상)
- 스캔 결과: 1~5개
- 통과율: 5~10%
- 품질: 여전히 높은 점수 종목만 추천

## 🚀 구현 우선순위

1. **즉시**: 기본값 완화 (방안 1)
2. **단기**: Fallback에서 점진적 완화 (방안 2)
3. **중기**: 하드 → 소프트 전환 검토 (방안 3)


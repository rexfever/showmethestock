# 레짐 분석 버전 선택 가이드

**최종 업데이트**: 2025-11-24

## 권장 버전

### 🎯 기본 권장: **V4 (Global Regime v4)**

**이유:**
- 가장 정확한 시장 상황 분석
- 한국/미국 시장 + 리스크 분석 모두 포함
- 중장기 추세 반영 (20일, 60일)
- 추세와 리스크를 분리하여 더 정교한 레짐 결정

**사용 조건:**
- 미국 시장 데이터 (SPY, QQQ, VIX) 캐시 필요
- 한국 시장 데이터 (KOSPI200) 캐시 필요
- 데이터가 없으면 자동으로 V3 또는 V1으로 fallback

## 버전별 상세 비교

### V1 (기본 장세 분석)

**장점:**
- ✅ 빠른 분석 속도
- ✅ 데이터 요구사항 낮음 (한국만)
- ✅ 안정적이고 검증된 로직
- ✅ 외부 의존성 없음

**단점:**
- ❌ 글로벌 시장 고려 없음
- ❌ 리스크 분석 없음
- ❌ 단기 분석 중심

**사용 권장 시나리오:**
- 미국 시장 데이터가 없는 경우
- 빠른 분석이 필요한 경우
- 단순한 장세 판단만 필요한 경우
- 시스템 안정성이 최우선인 경우

### V3 (Global Regime v3)

**장점:**
- ✅ 글로벌 시장 연동 (한국 + 미국)
- ✅ 단기 추세 분석 (3일, 5일)
- ✅ 미국 프리오픈 리스크 고려

**단점:**
- ❌ 리스크 분석이 제한적 (미국 프리오픈만)
- ❌ 중장기 추세 미반영
- ❌ 미국 데이터 스냅샷 필요

**사용 권장 시나리오:**
- V4 데이터 요구사항을 충족하지 못하는 경우
- 단기 매매 중심인 경우
- 글로벌 연동이 필요하지만 리스크 분석은 덜 중요한 경우

### V4 (Global Regime v4) - 권장

**장점:**
- ✅ 가장 정교한 시장 분석
- ✅ 한국/미국 리스크 모두 분석
- ✅ 중장기 추세 반영 (20일, 60일)
- ✅ 추세와 리스크 분리 계산
- ✅ 정확한 레짐 결정 (bull/neutral/bear/crash)

**단점:**
- ❌ 데이터 요구사항 높음 (한국 + 미국 OHLCV)
- ❌ 분석 시간이 약간 더 걸림
- ❌ 데이터가 없으면 fallback 발생

**사용 권장 시나리오:**
- **기본 권장**: 대부분의 경우
- 정확한 시장 상황 분석이 필요한 경우
- 리스크 관리가 중요한 경우
- 중장기 투자 전략인 경우
- 미국 시장 데이터가 있는 경우

## 선택 결정 트리

```
시장 분석이 필요한가?
│
├─ 미국 시장 데이터가 있는가?
│  │
│  ├─ 예 → V4 사용 (권장)
│  │     │
│  │     └─ V4 실패 시 → V3 자동 fallback
│  │                       │
│  │                       └─ V3 실패 시 → V1 자동 fallback
│  │
│  └─ 아니오 → V1 사용
│
└─ 빠른 분석이 필요한가?
   │
   └─ 예 → V1 사용
```

## 실제 사용 권장사항

### 프로덕션 환경

**권장: V4**

이유:
1. 가장 정확한 분석
2. 자동 fallback으로 안정성 보장
3. 리스크 관리 중요

설정:
```sql
UPDATE scanner_settings 
SET setting_value = 'v4', updated_at = NOW() 
WHERE setting_key = 'regime_version';
```

### 개발/테스트 환경

**권장: V1 또는 V4**

- 빠른 테스트: V1
- 정확한 검증: V4

### 데이터 제약이 있는 경우

**권장: V1**

- 미국 데이터 수집 불가
- 외부 API 제한
- 빠른 프로토타이핑

## 버전별 성능 비교

| 항목 | V1 | V3 | V4 |
|------|----|----|----|
| 분석 속도 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ |
| 분석 정확도 | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 데이터 요구사항 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ |
| 리스크 분석 | ⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 글로벌 연동 | ❌ | ✅ | ✅ |
| 중장기 추세 | ❌ | ❌ | ✅ |

## 마이그레이션 가이드

### V1 → V4 마이그레이션

1. **데이터 준비**
   - 미국 시장 데이터 캐시 확인
   - 한국 시장 데이터 캐시 확인

2. **테스트**
   - V4로 설정 후 테스트 스캔 실행
   - fallback 동작 확인

3. **프로덕션 적용**
   - 관리자 UI에서 V4 선택
   - 모니터링 강화

### V3 → V4 마이그레이션

1. **데이터 확인**
   - OHLCV 캐시 데이터 확인
   - V3 스냅샷과 호환성 확인

2. **점진적 전환**
   - V4로 변경 후 결과 비교
   - 문제 없으면 유지

## 문제 해결

### V4가 작동하지 않는 경우

1. **데이터 확인**
   ```bash
   # 캐시 디렉토리 확인
   ls -la cache/us_futures/
   ls -la backend/data_cache/
   ```

2. **Fallback 확인**
   - 로그에서 자동 fallback 확인
   - V3 또는 V1으로 자동 전환됨

3. **수동 Fallback**
   - V4 실패 시 V3로 변경
   - V3 실패 시 V1로 변경

## 결론

**기본 권장: V4**

- 가장 정확한 분석
- 자동 fallback으로 안정성 보장
- 리스크 관리 강화

**예외 상황:**
- 미국 데이터 없음 → V1
- 빠른 분석 필요 → V1
- 단기 매매 중심 → V3

## 관련 문서

- [레짐 분석 가이드](./REGIME_ANALYSIS.md)
- [레짐 버전 선택 가이드](./REGIME_VERSION_SELECTION.md)
- [프로젝트 개요](../PROJECT_OVERVIEW.md)


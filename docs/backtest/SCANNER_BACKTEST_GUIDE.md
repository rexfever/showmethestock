# ìŠ¤ìºë„ˆ ë°±í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-11-24

## ê°œìš”

`scanner_backtest.py`ëŠ” ì§€ì •ëœ ë‚ ì§œ ë²”ìœ„ì— ëŒ€í•´ ìŠ¤ìºë„ˆë¥¼ ì‹¤í–‰í•˜ê³  ì„±ê³¼ë¥¼ ë¶„ì„í•˜ëŠ” ë°±í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤.

### ì£¼ìš” ê¸°ëŠ¥

- âœ… ë‚ ì§œ ë²”ìœ„ ì§€ì • (ì‹œì‘ì¼ ~ ì¢…ë£Œì¼)
- âœ… ìºì‹œ ë°ì´í„° í™œìš© (ë©”ëª¨ë¦¬ + ë””ìŠ¤í¬ ìºì‹œ)
- âœ… ìŠ¤ìºë„ˆ ë²„ì „ ì„ íƒ (V1/V2)
- âœ… ë ˆì§ ë¶„ì„ ë²„ì „ ì„ íƒ (V1/V3/V4)
- âœ… ì„±ê³¼ ë¶„ì„ (í‰ê·  ìˆ˜ìµë¥ , ìŠ¹ë¥ )
- âœ… ê²°ê³¼ ì €ì¥ (JSON, CSV)

## ì‚¬ìš© ë°©ë²•

### ê¸°ë³¸ ì‚¬ìš©ë²•

```bash
cd backend
python backtest/scanner_backtest.py \
  --start-date 20251001 \
  --end-date 20251031 \
  --save-results
```

### ì£¼ìš” ì˜µì…˜

#### í•„ìˆ˜ ì˜µì…˜

- `--start-date YYYYMMDD`: ì‹œì‘ ë‚ ì§œ
- `--end-date YYYYMMDD`: ì¢…ë£Œ ë‚ ì§œ

#### ì„ íƒ ì˜µì…˜

- `--scanner-version {v1,v2}`: ìŠ¤ìºë„ˆ ë²„ì „ (ê¸°ë³¸: DB ì„¤ì •)
- `--regime-version {v1,v3,v4}`: ë ˆì§ ë¶„ì„ ë²„ì „ (ê¸°ë³¸: DB ì„¤ì •)
- `--kospi-limit N`: KOSPI ì¢…ëª© ìˆ˜ ì œí•œ (ê¸°ë³¸: config ê°’)
- `--kosdaq-limit N`: KOSDAQ ì¢…ëª© ìˆ˜ ì œí•œ (ê¸°ë³¸: config ê°’)
- `--days-after N`: ì„±ê³¼ ì¸¡ì • ì¼ìˆ˜ (ê¸°ë³¸: 5ì¼)
- `--no-cache`: ìºì‹œ ì‚¬ìš© ì•ˆ í•¨
- `--output-dir DIR`: ê²°ê³¼ ì €ì¥ ë””ë ‰í† ë¦¬ (ê¸°ë³¸: `backtest_results`)
- `--save-results`: ê²°ê³¼ë¥¼ íŒŒì¼ë¡œ ì €ì¥

### ì‚¬ìš© ì˜ˆì‹œ

#### 1. ê¸°ë³¸ ë°±í…ŒìŠ¤íŠ¸ (10ì›” ì „ì²´)

```bash
python backtest/scanner_backtest.py \
  --start-date 20251001 \
  --end-date 20251031 \
  --save-results
```

#### 2. V2 ìŠ¤ìºë„ˆ + V4 ë ˆì§ ë¶„ì„

```bash
python backtest/scanner_backtest.py \
  --start-date 20251001 \
  --end-date 20251031 \
  --scanner-version v2 \
  --regime-version v4 \
  --save-results
```

#### 3. ìºì‹œ ì—†ì´ ì‹¤í–‰ (ì‹¤ì‹œê°„ ë°ì´í„°ë§Œ ì‚¬ìš©)

```bash
python backtest/scanner_backtest.py \
  --start-date 20251001 \
  --end-date 20251031 \
  --no-cache \
  --save-results
```

#### 4. 10ì¼ í›„ ì„±ê³¼ ì¸¡ì •

```bash
python backtest/scanner_backtest.py \
  --start-date 20251001 \
  --end-date 20251031 \
  --days-after 10 \
  --save-results
```

#### 5. ìœ ë‹ˆë²„ìŠ¤ ì œí•œ

```bash
python backtest/scanner_backtest.py \
  --start-date 20251001 \
  --end-date 20251031 \
  --kospi-limit 50 \
  --kosdaq-limit 30 \
  --save-results
```

## ì¶œë ¥ ê²°ê³¼

### ì½˜ì†” ì¶œë ¥

```
ğŸ“… ë°±í…ŒìŠ¤íŠ¸ ê¸°ê°„: 20251001 ~ 20251031
ğŸ“Š ê±°ë˜ì¼ ìˆ˜: 22ê°œ
ğŸ”§ ìŠ¤ìºë„ˆ ë²„ì „: DB ì„¤ì •
ğŸ”§ ë ˆì§ ë²„ì „: DB ì„¤ì •
ğŸ’¾ ìºì‹œ ì‚¬ìš©: True

ğŸ“¦ OHLCV ìºì‹œ ìƒíƒœ:
  ë©”ëª¨ë¦¬: 150 hits, 50 misses
  ë””ìŠ¤í¬: 200 íŒŒì¼, 45.32 MB

[1/22] 20251001 ìŠ¤ìº” ì¤‘... âœ… ì™„ë£Œ (5ê°œ ì¢…ëª©)
[2/22] 20251002 ìŠ¤ìº” ì¤‘... âœ… ì™„ë£Œ (3ê°œ ì¢…ëª©)
...

================================================================================
ğŸ“Š ë°±í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½
================================================================================

âœ… ì„±ê³µí•œ ìŠ¤ìº”: 22ê°œ
ğŸ“ˆ ì´ ì¶”ì²œ ì¢…ëª©: 88ê°œ
ğŸ“… ë¶„ì„ ì™„ë£Œ ë‚ ì§œ: 22ê°œ

ğŸ“Š ì „ì²´ ì„±ê³¼:
  í‰ê·  ìˆ˜ìµë¥ : 2.45%
  ìŠ¹ë¥ : 68.18%

ğŸ“… ë‚ ì§œë³„ ì„±ê³¼:
  20251001: 5ê°œ ì¢…ëª©, í‰ê·  3.21%, ìŠ¹ë¥  80.00%
  20251002: 3ê°œ ì¢…ëª©, í‰ê·  1.89%, ìŠ¹ë¥  66.67%
  ...
```

### ì €ì¥ëœ íŒŒì¼

#### 1. ìŠ¤ìº” ê²°ê³¼ (JSON)

`backtest_results/scan_results_YYYYMMDD_HHMMSS.json`

```json
[
  {
    "date": "20251001",
    "success": true,
    "items": [
      {
        "ticker": "005930",
        "name": "ì‚¼ì„±ì „ì",
        "score": 8.5,
        "current_price": 75000,
        ...
      }
    ],
    "matched_count": 5,
    "scanner_version": "v2",
    "regime_version": "v4",
    "market_condition": {
      "version": "regime_v4",
      "final_regime": "bull",
      ...
    }
  }
]
```

#### 2. ì„±ê³¼ ë¶„ì„ (JSON)

`backtest_results/performance_YYYYMMDD_HHMMSS.json`

```json
{
  "total_scans": 22,
  "total_items": 88,
  "analyzed_dates": 22,
  "overall_avg_return": 2.45,
  "overall_win_rate": 68.18,
  "performance_by_date": {
    "20251001": {
      "items_count": 5,
      "avg_return": 3.21,
      "win_rate": 80.0,
      "items": [...]
    }
  }
}
```

#### 3. ì„±ê³¼ ìš”ì•½ (CSV)

`backtest_results/performance_summary_YYYYMMDD_HHMMSS.csv`

```csv
date,items_count,avg_return,win_rate
20251001,5,3.21,80.0
20251002,3,1.89,66.67
...
```

## ìºì‹œ í™œìš©

### ìºì‹œ í™•ì¸

ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì‹œ ìºì‹œ ìƒíƒœê°€ ìë™ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤:

```
ğŸ“¦ OHLCV ìºì‹œ ìƒíƒœ:
  ë©”ëª¨ë¦¬: 150 hits, 50 misses
  ë””ìŠ¤í¬: 200 íŒŒì¼, 45.32 MB
```

### ìºì‹œ í™œìš© ë°©ë²•

1. **ë©”ëª¨ë¦¬ ìºì‹œ**: ê°™ì€ í”„ë¡œì„¸ìŠ¤ ë‚´ì—ì„œ ì¬ì‚¬ìš©
2. **ë””ìŠ¤í¬ ìºì‹œ**: ê³¼ê±° ë‚ ì§œ ë°ì´í„°ëŠ” ë””ìŠ¤í¬ì—ì„œ ë¡œë“œ
3. **ìë™ ìºì‹±**: ìƒˆë¡œìš´ ë°ì´í„°ëŠ” ìë™ìœ¼ë¡œ ìºì‹œì— ì €ì¥

### ìºì‹œ ë¹„í™œì„±í™”

`--no-cache` ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ëª¨ë“  ë°ì´í„°ë¥¼ APIì—ì„œ ì§ì ‘ ì¡°íšŒí•©ë‹ˆë‹¤:

```bash
python backtest/scanner_backtest.py \
  --start-date 20251001 \
  --end-date 20251031 \
  --no-cache
```

## ì„±ê³¼ ë¶„ì„

### ì¸¡ì • ê¸°ì¤€

- **í‰ê·  ìˆ˜ìµë¥ **: ìŠ¤ìº” ë‹¹ì¼ ê°€ê²© ëŒ€ë¹„ Nì¼ í›„ ê°€ê²©ì˜ í‰ê·  ìˆ˜ìµë¥ 
- **ìŠ¹ë¥ **: ìˆ˜ìµì„ ë‚¸ ì¢…ëª©ì˜ ë¹„ìœ¨

### ì„±ê³¼ ì¸¡ì • ì¼ìˆ˜

`--days-after` ì˜µì…˜ìœ¼ë¡œ ì„±ê³¼ ì¸¡ì • ì¼ìˆ˜ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- `--days-after 1`: ë‹¤ìŒ ê±°ë˜ì¼ ì¢…ê°€ ê¸°ì¤€
- `--days-after 5`: 5ì¼ í›„ ê±°ë˜ì¼ ì¢…ê°€ ê¸°ì¤€ (ê¸°ë³¸)
- `--days-after 10`: 10ì¼ í›„ ê±°ë˜ì¼ ì¢…ê°€ ê¸°ì¤€

## ì£¼ì˜ì‚¬í•­

### 1. ê±°ë˜ì¼ë§Œ ìŠ¤ìº”

ì£¼ë§ê³¼ ê³µíœ´ì¼ì€ ìë™ìœ¼ë¡œ ì œì™¸ë©ë‹ˆë‹¤.

### 2. ìºì‹œ ë°ì´í„° ì˜ì¡´ì„±

ê³¼ê±° ë‚ ì§œ ë°ì´í„°ê°€ ìºì‹œì— ì—†ìœ¼ë©´ API í˜¸ì¶œì´ ë°œìƒí•©ë‹ˆë‹¤. ëŒ€ëŸ‰ ë°±í…ŒìŠ¤íŠ¸ ì‹œ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 3. ì„±ê³¼ ì¸¡ì • í•œê³„

- ì‹¤ì œ ë§¤ë§¤ ë¹„ìš©(ìˆ˜ìˆ˜ë£Œ, ì„¸ê¸ˆ) ë¯¸ë°˜ì˜
- ìŠ¬ë¦¬í”¼ì§€ ë¯¸ë°˜ì˜
- ì‹œì¥ ì¶©ê²© ë¯¸ë°˜ì˜

### 4. ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰

ëŒ€ëŸ‰ ë°±í…ŒìŠ¤íŠ¸ ì‹œ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì¦ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ë¬¸ì œ í•´ê²°

### ìºì‹œê°€ ì‘ë™í•˜ì§€ ì•ŠëŠ” ê²½ìš°

1. ë””ìŠ¤í¬ ìºì‹œ ë””ë ‰í† ë¦¬ í™•ì¸:
   ```bash
   ls -la cache/ohlcv/
   ```

2. ìºì‹œ í†µê³„ í™•ì¸:
   ```python
   from kiwoom_api import api
   print(api.get_ohlcv_cache_stats())
   ```

### ìŠ¤ìº”ì´ ì‹¤íŒ¨í•˜ëŠ” ê²½ìš°

1. ë¡œê·¸ í™•ì¸: ê° ë‚ ì§œë³„ ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸
2. ê±°ë˜ì¼ í™•ì¸: ì£¼ë§/ê³µíœ´ì¼ì€ ìë™ìœ¼ë¡œ ê±´ë„ˆëœ€
3. API ì—°ê²° í™•ì¸: í‚¤ì›€ API ì—°ê²° ìƒíƒœ í™•ì¸

### ì„±ê³¼ ë¶„ì„ì´ ì•ˆ ë˜ëŠ” ê²½ìš°

1. ë°ì´í„° ë¶€ì¡±: Nì¼ í›„ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¶„ì„ ë¶ˆê°€
2. ì¢…ëª© ì½”ë“œ ì˜¤ë¥˜: ì˜ëª»ëœ ì¢…ëª© ì½”ë“œëŠ” ìë™ìœ¼ë¡œ ì œì™¸

## ê´€ë ¨ ë¬¸ì„œ

- [OHLCV ìºì‹± ê°€ì´ë“œ](../code-review/OHLCV_CACHING_IMPLEMENTATION.md)
- [ìŠ¤ìºë„ˆ V2 ì‚¬ìš© ê°€ì´ë“œ](../scanner-v2/SCANNER_V2_USAGE.md)
- [ë ˆì§ ë¶„ì„ ê°€ì´ë“œ](../strategy/REGIME_ANALYSIS.md)


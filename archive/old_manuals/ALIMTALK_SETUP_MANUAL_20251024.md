# 카카오 알림톡 발송 설정 매뉴얼 - 2025.10.24

## 📋 개요
ShowMeTheStock 서비스의 카카오 알림톡 발송 기능을 활성화하기 위한 단계별 설정 가이드입니다.

---

## 🚀 1단계: Solapi 계정 생성 (5분)

### 1.1 회원가입
```
1. https://solapi.com 접속
2. "회원가입" 클릭
3. 이메일/비밀번호 입력
4. 휴대폰 인증 완료
5. 사업자등록증 업로드 (법인/개인사업자)
```

### 1.2 계정 인증
- **개인사업자**: 사업자등록증 + 신분증
- **법인**: 사업자등록증 + 법인등기부등본
- **승인 시간**: 1-2 영업일

---

## 🔑 2단계: API 키 발급 (2분)

### 2.1 API 키 생성
```
1. Solapi 콘솔 로그인
2. "개발자 도구" > "API Key 관리" 메뉴
3. "새 API Key 생성" 클릭
4. API Key 이름: "ShowMeTheStock"
5. 권한: "메시지 발송" 체크
6. "생성" 클릭
```

### 2.2 키 정보 확인
```
생성 완료 후 다음 정보 복사:
- API Key: NCSAYU7YDBXYORXC (예시)
- API Secret: NJUB8BQYXX7YO30OQBQNYQKQF9W3PQDN (예시)
```

---

## 📱 3단계: 카카오 채널 생성 (10분)

### 3.1 카카오 비즈니스 채널 생성
```
1. https://business.kakao.com 접속
2. "채널 만들기" 클릭
3. 채널 정보 입력:
   - 채널명: "스톡인사이트" 또는 "ShowMeTheStock"
   - 채널 ID: @showmethestock
   - 카테고리: 금융/투자
   - 채널 소개: "AI 기반 주식 스캐너 서비스"
4. 프로필 이미지 업로드
5. "채널 만들기" 완료
```

### 3.2 채널 ID 확인
```
채널 생성 후 확인:
- 채널 ID: @showmethestock
- PF ID: pfxxxxxxxxxxxxxx (자동 생성)
```

---

## 🔗 4단계: Solapi-카카오 채널 연동 (5분)

### 4.1 채널 연동
```
1. Solapi 콘솔 > "알림톡" > "채널 관리"
2. "채널 추가" 클릭
3. 카카오 비즈니스 계정으로 로그인
4. 생성한 채널 선택
5. "연동 완료" 확인
```

### 4.2 PF ID 확인
```
연동 완료 후:
- PF ID: pfxxxxxxxxxxxxxx
- 상태: "연동됨"
- 채널명: "스톡인사이트"
```

---

## 📝 5단계: 알림톡 템플릿 등록 (30분)

### 5.1 템플릿 작성
```
1. Solapi 콘솔 > "알림톡" > "템플릿 관리"
2. "새 템플릿 등록" 클릭
3. 템플릿 정보 입력:
```

**템플릿 코드**: `STOCK_SCAN_RESULT`
**템플릿명**: 스톡인사이트 일일 스캔 결과
**카테고리**: 금융/투자

**템플릿 내용**:
```
📊 스톡인사이트 일일 스캔 결과

안녕하세요! 오늘의 주식 스캔 결과를 알려드립니다.

📅 스캔 일시: #{s_date}
🎯 매칭 종목: #{s_num}개
📈 강한 매수 신호 종목들이 발견되었습니다!

상세 정보는 아래 링크에서 확인하세요:
🔗 https://sohntech.ai.kr/customer-scanner

스톡인사이트
```

**변수 설명**:
- `#{s_date}`: 스캔 실행 날짜
- `#{s_num}`: 매칭된 종목 수

### 5.2 템플릿 승인 요청
```
4. "승인 요청" 클릭
5. 승인 사유: "고객에게 일일 주식 스캔 결과 알림 발송"
6. 발송 예정량: "월 1,000건 이하"
7. "제출" 클릭
```

### 5.3 승인 대기
- **승인 시간**: 3-7 영업일
- **승인 상태**: Solapi 콘솔에서 확인 가능
- **승인 완료 시**: 템플릿 ID 자동 생성

---

## ⚙️ 6단계: 환경변수 설정 (2분)

### 6.1 .env 파일 수정
```bash
# backend/.env 파일 열기
nano /Users/a201808029/sandbox/showmethestock/backend/.env
```

### 6.2 키 정보 입력
```env
# Solapi (Kakao Alimtalk) API
SOLAPI_API_KEY=NCSAYU7YDBXYORXC
SOLAPI_API_SECRET=NJUB8BQYXX7YO30OQBQNYQKQF9W3PQDN
SOLAPI_API_BASE=https://api.solapi.com

# Solapi Channel Information  
SOLAPI_PF_ID=pfxxxxxxxxxxxxxx
SOLAPI_TEMPLATE_ID=STOCK_SCAN_RESULT

# Notification Recipients
NOTIFICATION_RECIPIENTS=010-1234-5678,010-9876-5432
```

### 6.3 수신자 번호 설정
```env
# 실제 수신받을 전화번호로 변경
NOTIFICATION_RECIPIENTS=010-1111-2222,010-3333-4444
```

---

## 🧪 7단계: 테스트 발송 (5분)

### 7.1 서버 재시작
```bash
cd /Users/a201808029/sandbox/showmethestock/backend
python main.py
```

### 7.2 테스트 API 호출
```bash
# 수동 테스트 발송
curl -X POST "http://localhost:8010/send_scan_result?to=010-1111-2222"
```

### 7.3 결과 확인
```json
{
  "status": "ok",
  "matched_count": 5,
  "sent_to": "010-1111-2222",
  "message_preview": "📊 스톡인사이트 일일 스캔 결과...",
  "provider": {
    "ok": true,
    "messageId": "M4V20180307110044DTYYJBBYLPQZIB1"
  }
}
```

---

## 📊 8단계: 자동 발송 설정 (선택사항)

### 8.1 현재 자동 발송 시간
- **오전 9시**: 장 시작 전 스캔 결과
- **오후 3시**: 장 마감 후 스캔 결과

### 8.2 발송 시간 변경 (필요시)
```python
# backend/main.py에서 스케줄 수정
scheduler.add_job(
    func=send_daily_notifications,
    trigger="cron",
    hour=18,  # 오후 6시로 변경
    minute=0,
    id='daily_notifications'
)
```

---

## 💰 9단계: 요금 및 사용량 관리

### 9.1 Solapi 요금
- **알림톡**: 건당 15원 (VAT 별도)
- **월 무료 크레딧**: 3,000원 (신규 가입 시)
- **충전 단위**: 최소 10,000원

### 9.2 예상 비용 (월 1,000건 기준)
```
발송 비용: 1,000건 × 15원 = 15,000원
VAT 10%: 1,500원
총 비용: 16,500원/월
```

### 9.3 크레딧 충전
```
1. Solapi 콘솔 > "결제" > "크레딧 충전"
2. 충전 금액 선택 (10,000원 이상)
3. 결제 수단 선택 (카드/계좌이체)
4. 결제 완료
```

---

## 🔍 10단계: 모니터링 및 관리

### 10.1 발송 현황 확인
```
Solapi 콘솔 > "통계" > "발송 현황"
- 발송 성공률
- 실패 원인 분석
- 일별/월별 발송량
```

### 10.2 로그 확인
```bash
# 서버 로그에서 알림톡 발송 기록 확인
tail -f /Users/a201808029/sandbox/showmethestock/backend/server.log | grep "알림톡"
```

### 10.3 문제 해결
**발송 실패 시 체크사항:**
- [ ] API 키 정확성
- [ ] 크레딧 잔액 확인
- [ ] 템플릿 승인 상태
- [ ] 수신자 번호 형식 (010-xxxx-xxxx)

---

## 📋 체크리스트

### 필수 완료 항목
- [ ] Solapi 계정 생성 및 인증
- [ ] API 키 발급
- [ ] 카카오 채널 생성
- [ ] 채널-Solapi 연동
- [ ] 알림톡 템플릿 등록 및 승인
- [ ] 환경변수 설정
- [ ] 테스트 발송 성공
- [ ] 크레딧 충전

### 선택 완료 항목
- [ ] 자동 발송 시간 조정
- [ ] 수신자 그룹 관리
- [ ] 발송 통계 모니터링 설정

---

## 🚨 주의사항

### 법적 준수사항
- **개인정보보호법**: 수신자 동의 필수
- **정보통신망법**: 광고성 정보 표시 의무
- **전기통신사업법**: 스팸 발송 금지

### 기술적 제한사항
- **일일 발송 한도**: 계정별 10,000건
- **템플릿 변수**: 최대 20개
- **메시지 길이**: 최대 1,000자

### 운영 권장사항
- **발송 시간**: 오전 9시-오후 6시 권장
- **발송 빈도**: 일 1-2회 이하
- **수신자 관리**: 수신 거부 기능 제공

---

## 📞 지원 및 문의

### Solapi 고객지원
- **전화**: 1588-0902
- **이메일**: support@solapi.com
- **운영시간**: 평일 9시-18시

### 카카오 비즈니스 지원
- **고객센터**: 1544-4293
- **온라인 문의**: https://business.kakao.com/support

---

**작성일**: 2025년 10월 24일  
**작성자**: 개발팀  
**예상 소요시간**: 총 1-2시간 (승인 대기 제외)  
**완료 후 상태**: 즉시 알림톡 발송 가능